<?xml version="1.0" encoding="UTF-8"?>
<Document>
 <Model version="4.1" build="4.1.4.1">
    <Sidops>
<![CDATA[model 128 184 description '<Description>
   <Version>4.1</Version>
<IsMainModel>0</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
   <LibraryPath>Z:\Users\yury\Desktop\youbot_control_with_base_sefltest1.emx</LibraryPath>
  <TimeStamp>2012-5-2 10:47:30</TimeStamp>
</Description>'; type 'Mainmodel-8044' end; implementation bg  submodels   CartesianSpaceStiffness 176 232    description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Sources\Constant.emx</LibraryPath> <TimeStamp>2007-10-19 14:48:44</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';    type Constant     ports      signal out output [9,1];    end;    icon bg left     figures      rectangle 160.1 216 191.9 248 fill 15132390;      line 164.9 227.6 186.9 227.6 color 16711680 width 2;      line 162.2 238.7 187.9 238.7;      line 164.5 222.7 164.5 241;    end;    implementation eqparameters	real Kt[3] = [1000;1000;1000];		// output value	real Kr[3] = [100;100;100];		// output value	real Kc[3] = [0;0;0];		// output valueequations	output[1:3] = Kt;	output[4:6] = Kr;	output[7:9] = Kc;     implementation_end;   HtipCC 176 200    description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Sources\Constant.emx</LibraryPath> <TimeStamp>2007-10-19 14:48:44</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';    type Constant     ports      signal out output [4,4];    end;    icon bg left     figures      rectangle 160.1 184 191.9 216 fill 15132390;      line 164.9 195.6 186.9 195.6 color 16711680 width 2;      line 162.2 206.7 187.9 206.7;      line 164.5 190.7 164.5 209;    end;    implementation eqparameters 	//boolean vp_equal_to_tip=true;	real H_eye[4,4]= [ 1, 0, 0, 0;					  	  0, 1, 0, 0;					     0, 0, 1, 0 ;					     0, 0, 0, 1 ]; // latex notation H^{tip}_{cc}equations	output=H_eye;implementation_end;   Hvp0 176 168    description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Sources\Constant.emx</LibraryPath> <TimeStamp>2007-10-19 14:48:44</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';    type Constant     ports      signal out output [4,4];    end;    icon bg left     figures      rectangle 160.1 152 191.9 184 fill 15132390;      line 164.9 163.6 186.9 163.6 color 16711680 width 2;      line 162.2 174.7 187.9 174.7;      line 164.5 158.7 164.5 177;    end;    implementation eqparameters 	//boolean vp_equal_to_tip=true;	real H_eye[4,4]= [ 1, 0, 0, 1;					  	  0, 1, 0, 1;					     0, 0, 1, 0.5 ;					     0, 0, 0, 1 ]; // latex notation H^{tip}_{cc}equations	output=H_eye;implementation_end;   JointSpaceSetpoint 176 264    description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Sources\Constant.emx</LibraryPath> <TimeStamp>2007-10-19 14:48:44</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';    type Constant     ports      signal out output [8,1];    end;    icon bg left     figures      rectangle 160.1 248 191.9 280 fill 15132390;      line 164.9 259.6 186.9 259.6 color 16711680 width 2;      line 162.2 270.7 187.9 270.7;      line 164.5 254.7 164.5 273;    end;    implementation eqequations	output=0;implementation_end;   JointSpaceSetpoint1 352 352    description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Sources\Constant.emx</LibraryPath> <TimeStamp>2007-10-19 14:48:44</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';    type Constant     ports      signal out output [8,1];    end;    icon bg left     figures      rectangle 336.1 336 367.9 368 fill 15132390;      line 340.9 347.6 362.9 347.6 color 16711680 width 2;      line 338.2 358.7 363.9 358.7;      line 340.5 342.7 340.5 361;    end;    implementation eqequations	output=0;implementation_end;   YouBot_control_with_base 352.3 224    description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';    type Submodel     ports      signal in Arm1_joint_states [5,1];      signal in Measured_odometry [3,1];      signal in Arm1_joint_velocites [5,1];      signal in Base_joint_velocities [4,1];      signal out Arm1_joint_cmd [5,1];      signal out Base_twist_cmd [3,1];      signal out Wtip0 [6,1];      signal out Base_twist [6,1];      signal out Base_torque_cmd [4,1];      signal in Base_joint_states [4,1];      signal in Hvp0 [4,4];      signal in CartSpaceStiffness [9,1];      signal in HtipCC [4,4];      signal in JointSpaceSetpoint [8,1];      signal in JntSpaceStiffness [8,1];      signal out Htip0 [4,4];      signal out JointStates [8,1];    end;    icon bg     figures      rectangle 296 160 408 288 fill 14013909;      text 'name' 352.3 216.7 16;     terminals      Arm1_joint_states 408 184 fixed;      Measured_odometry 408 168 fixed;      Arm1_joint_velocites 408 216 fixed;      Base_joint_velocities 408 200 fixed;      Arm1_joint_cmd 408 248 fixed;      Base_twist_cmd 408 264 fixed;      Wtip0 368 160 fixed;      Base_twist 336 160 fixed;      Base_torque_cmd 408 280 fixed;      Base_joint_states 408 232 fixed;      Hvp0 296 168 fixed;      CartSpaceStiffness 296 232 fixed;      HtipCC 296 200 fixed;      JointSpaceSetpoint 296 264 fixed;      JntSpaceStiffness 352 288 fixed;    end;    implementation bg     submodels      CalculateJ 544 256       description '<Description> <Version>4.1</Version> <LibraryPath>CalculateYoubotJ.emx</LibraryPath> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <TimeStamp>2011-1-19 15:06:55</TimeStamp> <AllowLibraryUpdate>False</AllowLibraryUpdate></Description>';       type Submodel        ports         signal in jointVelocities [8,1];         signal out controllableJ [6,8];         signal out Htip0 [4,4];        parameters         real InitialJointPos[5,1] = [1.0; 1.0; 1.0; 1.0; 1.0];         real Linkdim[3,6] = [0.024, 0.033, 0.0, 0.0, 0.0, 0.0; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0; 0.096, 0.019, 0.155, 0.135, 0.096, 0.034];         real InitialBasePos[4,4] = [1.0, 0.0, 0.0, 1.0; 0.0, 1.0, 0.0, 0.0; 0.0, 0.0, 1.0, 0.0; 0.0, 0.0, 0.0, 1.0];       end;       icon bg top        figures         rectangle 507 234 581 278 fill 11206627;         text 'CalculateYouBot J' 544 256 16;        terminals         Htip0 504 272 fixed;       end;       implementation eqparameters	real baseoffset[3]=[0.143;  0;  0.046]; //coordinates of joint_1 constants		real hidden vx[3] = [1;0;0];	real hidden vy[3] = [0;1;0];	real hidden omegaz[3] = [0;0;1];	real hidden omega1[3] = [0;0;-1]; 	real hidden omega2[3] = [0;1;0]; 	real hidden omega3[3] = [0;1;0]; 	real hidden omega4[3] = [0;1;0]; 	real hidden omega5[3] = [0;0;-1];	variables	real uTrzrefref[6];	real uTryrefref[6];	real uTrxrefref[6];	real uTr1refref[6];	real uTr211[6];		real uTr322[6];		real uTr433[6];	real uTr544[6];	real 					R1ref[3,3], 	R21[3,3], 	R32[3,3], 	R43[3,3], 	R54[3,3], 	Rtip5[3,3];	real 					p1ref[3], 		p21[3], 		p32[3], 		p43[3], 		p54[3], 		ptip5[3];	real 	Href0[4,4],	H1ref[4,4], 	H21[4,4], 	H32[4,4], 	H43[4,4], 	H54[4,4], 	Htip5[4,4];	real 					H10[4,4],		H20[4,4],	H30[4,4],	H40[4,4],	H50[4,4];		real base_offset_H[4,4];	real q[8];/*	real T[6];	real tildeT[4,4];	real dotH[4,4];*/	real initialq[8];real Rz[3,3];/*code	T = [0;0;jointVelocities[1];jointVelocities[3];jointVelocities[2];0];		tildeT = tilde(T);	dotH = Href0*tildeT;	Href0 = int(dotH,InitialBasePos);*/initialequations	initialq = [0;0;0;InitialJointPos[1];InitialJointPos[2];InitialJointPos[3];InitialJointPos[4];InitialJointPos[5]];equations	base_offset_H=homogeneous(eye(3),baseoffset);	q =jointVelocities;// int(jointVelocities,initialq);	Rz=[cos(q[1]), -sin(q[1]), 0; 		sin(q[1]), cos(q[1]), 	0;		 0, 					0, 					1];Href0 =homogeneous(Rz,[q[2];q[3];0])*base_offset_H;//Calculate relative positions of the jointsR1ref = [	cos(-q[4]),	-sin(-q[4]),	0;			sin(-q[4]),	cos(-q[4]),	0;			0,				0,				1];p1ref = Linkdim[1:3,1];H1ref = homogeneous(R1ref,p1ref);R21 = [	cos(q[5]),	0,	sin(q[5]);			0,				1,	0;			-sin(q[5]),	0,	cos(q[5])];p21 = Linkdim[1:3,2];H21 = homogeneous(R21,p21);R32 = [	cos(q[6]),	0,	sin(q[6]);			0,				1,	0;			-sin(q[6]),	0,	cos(q[6])];p32 = Linkdim[1:3,3];H32 = homogeneous(R32,p32);R43 = [	cos(q[7]),	0,	sin(q[7]);			0,				1,	0;			-sin(q[7]),	0,	cos(q[7])];p43 = Linkdim[1:3,4];H43 = homogeneous(R43,p43);R54 = [	cos(-q[8]),	-sin(-q[8]),	0;			sin(-q[8]),	cos(-q[8]),	0;			0,				0,				1];p54 = Linkdim[1:3,5];H54 = homogeneous(R54,p54);Rtip5 = eye(3);ptip5 = Linkdim[1:3,6];Htip5 = homogeneous(Rtip5,ptip5);//calculate position of the joints with respect to inertial frameH10 = Href0 * H1ref;H20 = H10 * H21;H30 = H20 * H32;H40 = H30 * H43;H50 = H40 * H54;Htip0 = H50 * Htip5;uTrzrefref[1:3] = omegaz; uTrzrefref[4:6] = 0;uTryrefref[1:3] = 0;uTryrefref[4:6] = vy;uTrxrefref[1:3] = 0;uTrxrefref[4:6] = vx;uTr1refref[1:3] = omega1;uTr1refref[4:6] = skew(Linkdim[1:3,1])*omega1;uTr211[1:3] = omega2;uTr211[4:6] = skew(Linkdim[1:3,2])*omega2;uTr322[1:3] = omega3;uTr322[4:6] = skew(Linkdim[1:3,3])*omega3;uTr433[1:3] = omega4;uTr433[4:6] = skew(Linkdim[1:3,4])*omega4;uTr544[1:3] = omega5;uTr544[4:6] = skew(Linkdim[1:3,5])*omega5;//Construct Geometric JacobiancontrollableJ[1:6,1] = Adjoint(Href0)*uTrzrefref;controllableJ[1:6,3] = Adjoint(Href0)*uTryrefref;controllableJ[1:6,2] = Adjoint(Href0)*uTrxrefref;controllableJ[1:6,4] = Adjoint(Href0)*uTr1refref;controllableJ[1:6,5] = Adjoint(H10)*uTr211;controllableJ[1:6,6] = Adjoint(H20)*uTr322;controllableJ[1:6,7] = Adjoint(H30)*uTr433;controllableJ[1:6,8] = Adjoint(H40)*uTr544;implementation_end;      CartesianSpaceStiffness 288 424       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Control\PID Control\Continuous\P.emx</LibraryPath> <TimeStamp>2008-1-17 10:48:8</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type P        ports         signal out effort [6,1];         signal in Hvp0 [4,4];         signal in Htip0 [4,4];         signal in cart_stiffness [9,1];         signal in HtipCC [4,4];       end;       icon bg        figures         rectangle 256 392 320 456 fill 15132390;         text 'CartesianSpace Stiffness' 288 426 color 16711680 15;        terminals         effort 320 424 fixed;         Hvp0 256 424 fixed;         Htip0 288 392 fixed;         cart_stiffness 256 408 fixed;         HtipCC 256 440 fixed;       end;       implementation eqparameters 	//boolean vp_equal_to_tip=true;	real Htip_cc[4,4]= [ 1, 0, 0, 0;					  	  0, 1, 0, 0;					     0, 0, 1, 0 ;					     0, 0, 0, 1 ]; // latex notation H^{tip}_{cc}variables	real Kt[3];	real Kr[3];	real Kc[3];	real Kcc[ 6, 6 ];	real Ktip[6,6];	real T1_00 [4,4], H_dot1_0[4,4],	H1_0[4,4];	real costiffness1[ 3, 3 ], costiffness2[ 3, 3 ], costiffness3[ 3, 3 ],		dummy1[ 3, 3 ], dummy2[ 3, 3 ], dummy3[ 3, 3 ], dummy4[ 3, 3 ], dummy5[ 3, 3 ],		pose21[ 4, 4 ], skew21[ 3, 3 ], orientation21[ 3, 3 ];	real Hvp0_temp[4,4];	boolean vp_equal_to_tip;initialequations	Hvp0_temp=eye(4);	vp_equal_to_tip=true;equations	Kt = cart_stiffness[1:3];	Kr = cart_stiffness[4:6];	Kc = cart_stiffness[7:9];	if vp_equal_to_tip then		Hvp0_temp=Htip0;		vp_equal_to_tip=false;	else		Hvp0_temp=Hvp0;	end;	H1_0 =inverseH(Hvp0_temp)*Htip0;// inverseH(Htip0)*Hvp0_temp;// =H0tip*Hvp0 int (H_dot1_0, H1_0_initial);		Kcc[1:3,1:3] = diag(Kr);	Kcc[1:3,4:6] = diag(Kc);	Kcc[4:6,1:3] = transpose(diag(Kc)); // is it correct of it should be negative	Kcc[4:6,4:6] = diag(Kt); 	Ktip=transpose(Adjoint(Htip_cc))*Kcc*Adjoint(Htip_cc);//latex noation K_{tip}=(Ad_{H^{tip}_{cc}})^{T}*K_{cc}*Ad_{H^{tip}_{cc}}	dummy1 = Ktip[ 1 : 3, 1 : 3 ];	dummy2 = Ktip[ 1 : 3, 4 : 6 ];	dummy3 = Ktip[ 4 : 6, 4 : 6 ];	costiffness1 = 0.5 * trace( dummy1 ) * eye( 3 ) - dummy1;	costiffness2 = 0.5 * trace( dummy2 ) * eye( 3 ) - dummy2;	costiffness3 = 0.5 * trace( dummy3 ) * eye( 3 ) - dummy3;	"create T_tilde from the twist T1_00 of body 1 in coordinates of body 0 with respect to body 0"//	T1_00 = tilde (p.f);		"create the H_dot matrix for calculation of the transformation matrix H from body 1 to body 0"//	H_dot1_0 = T1_00 * H1_0;		pose21 = H1_0;	skew21 = skew( pose21[ 1 : 3, 4 ] );	orientation21 = pose21[ 1 : 3, 1 : 3 ];	dummy4 = 2 * antisym( costiffness1 * orientation21 ) + antisym( costiffness3 * transpose( orientation21 ) * skew21 * skew21 * orientation21 ) + 2 * antisym( costiffness2 * skew21 * orientation21 );	dummy5 = transpose( orientation21 ) * antisym( costiffness3 * skew21 ) * orientation21 + antisym( costiffness3 * transpose( orientation21 ) * skew21 * orientation21 ) + 2 * antisym( costiffness2 * orientation21 );	effort= -transpose(Adjoint(inverseH(Htip0)))* [ dummy4[ 3, 2 ]; dummy4[ 1, 3 ]; dummy4[ 2, 1 ]; dummy5[ 3, 2 ]; dummy5[ 1, 3 ]; dummy5[ 2, 1 ] ];implementation_end;      Complete_twist 1488 600.5       description '<Description> <Version>4.0</Version> <LibraryPath>Template\Submodel-Equation.emx</LibraryPath> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <TimeStamp>2007-11-1 22:32:1</TimeStamp> <AllowLibraryUpdate>False</AllowLibraryUpdate></Description>';       type 'Submodel-Equation'        ports         signal in Base_twist_cmd [3,1];         signal out Base_twist [6,1];       end;       icon bg        figures         rectangle 1432 577 1544 624 fill 14013909;         text 'name' 1488 601 16;        terminals         Base_twist_cmd 1432 600 fixed;         Base_twist 1544 600 fixed;       end;       implementation eqequationsBase_twist = [Base_twist_cmd[3]; Base_twist_cmd[2]; 0; 0; 0; Base_twist_cmd[1]];implementation_end;      Deadzone 712 328       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram Non-Linear\SignalLimiter-Limit.emx</LibraryPath> <TimeStamp>2007-9-26 12:47:40</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type 'SignalLimiter-Limit'        ports         signal in input [8,1];         signal out output [8,1];       end;       icon bg right        figures         group          rectangle 696 312 728 344 fill 15132390;          line 712.4 318.9 712.4 338.1;          line 699.4 336.2 706.7 328 717.5 328 723.9 319.1 color 16711680 fill 15132390 width 2;         end;       end;       implementation eqparameters	real p_deadzone[8]= [0.06;0.06;0.06;0.06;0.06;0.06;0.06;0.06];//friction on the speed more then 4 grad per sec	real n_deadzone[8]= [-0.06;-0.06;-0.06;-0.06;-0.06;-0.06;-0.06;-0.06];//friction on the speed more then 4 grad per secequations	output[1]=(limit((input[1]-n_deadzone[1]),-30,0))+(limit((input[1]-p_deadzone[1]),0,30));	output[2]=(limit((input[2]-n_deadzone[2]),-30,0))+(limit((input[2]-p_deadzone[2]),0,30));	output[3]=(limit((input[3]-n_deadzone[3]),-30,0))+(limit((input[3]-p_deadzone[3]),0,30));	output[4]=(limit((input[4]-n_deadzone[4]),-30,0))+(limit((input[4]-p_deadzone[4]),0,30));	output[5]=(limit((input[5]-n_deadzone[5]),-30,0))+(limit((input[5]-p_deadzone[5]),0,30));	output[6]=(limit((input[6]-n_deadzone[6]),-30,0))+(limit((input[6]-p_deadzone[6]),0,30));	output[7]=(limit((input[7]-n_deadzone[7]),-30,0))+(limit((input[7]-p_deadzone[7]),0,30));	output[8]=(limit((input[8]-n_deadzone[8]),-30,0))+(limit((input[8]-p_deadzone[8]),0,30));implementation_end;      Differentiate 904 136       description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\Differentiate-SVF.emx</LibraryPath>  <TimeStamp>2007-9-26 12:10:52</TimeStamp></Description>';       type 'Differentiate-SVF'        ports         signal in input [8,1];         signal out output [8,1];       end;       icon bg bottom        figures         rectangle 888 120 920 152 fill 15132390;         text 'd/dt' 905.1 131.7 color 16711680 13 bold;         text 'SVF' 904 142.9 color 16711680 13 bold;       end;       implementation eqparameters	real N [8]= [100.0;100.0;100.0;100.0;100.0;100.0;100.0;100.0];		// Derivative gain	real initial[8] = [0.0;0.0;0.0;0.0;0.0;0.0;0.0;0.0];	// Initial outputvariables	real hidden rate[8];	real hidden initial_input[8];	boolean hidden initialized;initialequations	initialized = false;equations	if not initialized then 		initial_input = input; 		initialized = true;	end;	rate  = - diag(N) * output;	output = diag(N) * (input - initial_input)  + int (rate,initial);implementation_end;      Differentiate1 1816 312       description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\Differentiate-SVF.emx</LibraryPath>  <TimeStamp>2007-9-26 12:10:52</TimeStamp></Description>';       type 'Differentiate-SVF'        ports         signal in input [4,1];         signal out output [4,1];       end;       icon bg bottom        figures         rectangle 1800 296 1832 328 fill 15132390;         text 'd/dt' 1817.1 307.7 color 16711680 13 bold;         text 'SVF' 1816 318.9 color 16711680 13 bold;       end;       implementation eqparameters	real N = 10.0;		// Derivative gain	real initial[4] = 0.0;	// Initial outputvariables	real hidden rate[4];	real hidden initial_input[4];	boolean hidden initialized;initialequations	initialized = false;equations	if not initialized then 		initial_input = input; 		initialized = true;	end;	rate  = - N * output;	output = N * (input - initial_input)  + int (rate,initial);implementation_end;      Fric_comp 1816 424       description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type Submodel        ports         signal in wheel_vel [4,1];         signal out fric_force [4,1];       end;       implementation bg        submodels         DEMUX 507.5 168          description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Submodel           ports            signal out force [4,1];            signal in FR;            signal in FL;            signal in RR;            signal in RL;          end;          icon bg           figures            rectangle 480 120 536 216 fill 14013909;            text 'DEMUX' 504 168 16;           terminals            force 536 168 fixed;            FR 483.5 152 fixed;            FL 483.5 136 fixed;            RR 483.5 208 fixed;            RL 483.5 192 fixed;          end;          implementation eqequations 	force[1] = FL;	force[2] = FR;	force[3] = RL;	force[4] = RR;	implementation_end;         MUX 152 168          description '<Description> <Version>4.0</Version> <LibraryPath>Template\Submodel-Equation.emx</LibraryPath> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <TimeStamp>2007-11-1 22:32:1</TimeStamp> <AllowLibraryUpdate>False</AllowLibraryUpdate></Description>';          type 'Submodel-Equation'           ports            signal in input [4,1];            signal out FR;            signal out FL;            signal out RR;            signal out RL;          end;          icon bg           figures            rectangle 128 120 176 216 fill 14013909;            text 'MUX' 152 168 16;           terminals            input 128 168 fixed;            FR 176 152 fixed;            FL 176 136 fixed;            RR 176 200 fixed;            RL 176 184 fixed;          end;          implementation eqequations	FL = input[1];	FR = input[2];	RL = input[3];	RR = input[4];implementation_end;         plug wheel_vel 40 168;         plug fric_force 624 168;         Wheel1 328 72          description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Submodel           ports            signal in vel;            signal out rfriction_FL;          end;          implementation eqparameters	real a =  0.05615;	real b = -8.68;	real c =  0.04245;	real d =  0.2383;	real a2 =  0.07022;	real b2 = -0.1932;	real c2 =  7.554e-10;	real d2 =  6.858;	real p11 = 0.07582;	real p12 = -0.1201;	real a3 =  3.243e9;	real b3 = -7.739;	real c3 =  0.07271;	real d3 =  0.09647;	real p21 = 0.0125;	real p22 = 0.05584;	real r_extra = 0.01;	real r_offset = 0.0;variables	real abs_vel;	real r1,r2,r3,r4,r5,r6,r7,r8;	real n;code	abs_vel = abs(vel);    	r1 = 5*abs_vel + 1e-6;	r2 = a*exp(b*abs_vel) + c*exp(d*abs_vel);	r3 = a2*exp(b2*abs_vel) + c2*exp(d2*abs_vel);	r4 = p11*abs_vel + p12;	r5 = a3*exp(b3*abs_vel) + c3*exp(d3*abs_vel);	r6 = p21*abs_vel + p22;    	r7 = 0.06 + 0.4*abs_vel;	r8 = 0.071 + 0.01*abs_vel;        	if abs_vel < 0.7 then		n = 25;		rfriction_FL = 1/(1/r1^n + 1/r2^n + 1/r7^n + 1/r8^n)^(1/n);	end;		if abs_vel >= 0.7 and abs_vel < 1.5 then		n = 30;		rfriction_FL = 1/(1/r2^n + 1/r3^n)^(1/n);	end;        	if abs_vel >= 1.5 and abs_vel < 2.5 then		rfriction_FL = r3;	end;    	if abs_vel >= 2.5 and abs_vel < 3.2 then		n = 30;		rfriction_FL = 1/(1/r3^n + 1/r4^n)^(1/n);	end;        	if abs_vel >= 3.2 and abs_vel < 3.5 then		n = 20;		rfriction_FL = 1/(1/r4^n + 1/r5^n)^(1/n);	end;        	if abs_vel >= 3.5 and abs_vel < 4.59 then		rfriction_FL = r5;	end;        	if abs_vel >= 4.59 then		rfriction_FL = r6;	end;        rfriction_FL = (rfriction_FL + r_extra)*sign(vel) + r_offset;implementation_end;         Wheel2 328 136          description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Submodel           ports            signal in vel;            signal out rfriction_FR;          end;          implementation eqparameters	real a =  0.05139;	real b = -6.585;	real c =  0.04364;	real d =  0.2313;	real a2 =  0.05552;	real b2 = -0.08399;	real c2 =  1.937e-6;	real d2 =  4.167;	real p11 = 0.08767;	real p12 = -0.1249;	real a3 =  7.255e4;	real b3 = -4.762;	real c3 =  0.07822;	real d3 =  0.09864;	real p21 = 0.01689;	real p22 = 0.04036;	real r_extra = 0.01;	real r_offset = 0.0;variables	real abs_vel;	real r1,r2,r3,r4,r5,r6,r7,r8;	real n;code	abs_vel = abs(vel);    	r1 = 5*abs_vel + 1e-6;	r2 = a*exp(b*abs_vel) + c*exp(d*abs_vel);	r3 = a2*exp(b2*abs_vel) + c2*exp(d2*abs_vel);	r4 = p11*abs_vel + p12;	r5 = a3*exp(b3*abs_vel) + c3*exp(d3*abs_vel);	r6 = p21*abs_vel + p22;    	r7 = 0.06 + 0.5*abs_vel;	r8 = 0.077 + 0.01*abs_vel;        	if abs_vel < 0.4 then		n = 25;		rfriction_FR = 1/(1/r1^n + 1/r2^n + 1/r7^n + 1/r8^n)^(1/n);	end;		if abs_vel >= 0.4 and abs_vel < 1.5 then		n = 45;		rfriction_FR = 1/(1/r2^n + 1/r3^n)^(1/n);	end;        	if abs_vel >= 1.5 and abs_vel < 2.2 then		rfriction_FR = r3;	end;    	if abs_vel >= 2.2 and abs_vel < 2.9 then		n = 45;		rfriction_FR = 1/(1/r3^n + 1/r4^n)^(1/n);	end;        	if abs_vel >= 2.9 and abs_vel < 3.5 then		n = 20;		rfriction_FR = 1/(1/r4^n + 1/r5^n)^(1/n);	end;        	if abs_vel >= 3.5 and abs_vel < 5.89 then		rfriction_FR = r5;	end;        	if abs_vel >= 5.89 then		rfriction_FR = r6;     	end;        rfriction_FR = (rfriction_FR + r_extra)*sign(vel) + r_offset;implementation_end;         Wheel3 328 200          description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Submodel           ports            signal in vel;            signal out rfriction_RL;          end;          implementation eqparameters	real a =  0.4187;	real b = -0.3006;	real c =  0.1296;	real a2 =  0.03022;	real b2 = -0.08004;	real c2 =  0.1077;	real a3 =  5306;	real b3 = -3.548;	real c3 =  0.09904;	real d3 =  0.08162;	real p21 = 0.01298;	real p22 = 0.08432;	real r_extra = 0.01;	real r_offset = 0.0;variables	real abs_vel;	real r1,r2,r3,r4,r5,r6,r7;	real n;code	abs_vel = abs(vel);    	r1 = 5*abs_vel + 1e-6;	r2 = a*abs_vel^2 + b*abs_vel + c;	r3 = a2*abs_vel^2 + b2*abs_vel + c2;	r4 = a3*exp(b3*abs_vel) + c3*exp(d3*abs_vel);	r5 = p21*abs_vel + p22;    	r6 = 0.08195 + 0.25*abs_vel;	r7 = 0.105 + 0.01*abs_vel;        	if abs_vel < 0.3 then		n = 40;		rfriction_RL = 1/(1/r1^n + 1/r2^n + 1/r6^n + 1/r7^n)^(1/n);	end;		if abs_vel >= 0.3 and abs_vel < 1 then		n = 45;		rfriction_RL = 1/(1/r2^n + 1/r3^n)^(1/n);	end;        	if abs_vel >= 1 and abs_vel < 3 then		rfriction_RL = r3;	end;    	if abs_vel >= 3 and abs_vel < 5.89 then		n = 12;		rfriction_RL = 1/(1/r3^n + 1/r4^n)^(1/n);	end;        	if abs_vel >= 5.89 then		rfriction_RL = r5;     	end;        rfriction_RL = (rfriction_RL + r_extra)*sign(vel) + r_offset;implementation_end;         Wheel4 328 264          description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Submodel           ports            signal in vel;            signal out rfriction_RR;          end;          implementation eqparameters	real a =  0.6494;	real b = -0.3383;	real c =  0.09933;	real a2 =  0.1069;	real b2 = -0.1064;	real c2 =  0.07555;	real p11 = 0.008156;	real p12 = 0.0449;	real a3 =  0.1098;	real b3 = -1.174;	real c3 =  4.627;	real d3 =  -7.879;	real e3 = 4.948;	real a4 = 2828;	real b4 = -3.707;	real c4 = 0.08658;	real d4 = 0.1062;	real p21 = 0.01829;	real p22 = 0.05499;	real r_extra = 0.01;	real r_offset = 0.0;variables	real abs_vel;	real r1,r2,r3,r4,r5,r6,r7,r8;	real n;code	abs_vel = abs(vel);    	r1 = 5*abs_vel + 1e-6;	r2 = a*abs_vel^2 + b*abs_vel + c;	r3 = a2*abs_vel^2 + b2*abs_vel + c2;	r4 = p11*abs_vel + p12;	r5 = a3*abs_vel^4 + b3*abs_vel^3 + c3*abs_vel^2 + d3*abs_vel + e3;	r6 = a4*exp(b4*abs_vel) + c4*exp(d4*abs_vel);	r7 = p21*abs_vel + p22;    	r8 = 0.06255 + 0.4255*abs_vel;        	if abs_vel < 0.2568 then		n = 10;		rfriction_RR = 1/(1/r1^n + 1/r2^n + 1/r8^n)^(1/n);	end;		if abs_vel >= 0.2568 and abs_vel < 0.555 then		rfriction_RR = r3;	end;        	if abs_vel >= 0.555 and abs_vel < 1.867 then		rfriction_RR = r4;	end;    	if abs_vel >= 1.867 and abs_vel < 2.7 then		n = 30;		rfriction_RR = r5;	end;        	if abs_vel >= 2.7 and abs_vel < 5.34 then		n = 30;		rfriction_RR = 1/(1/r5^n + 1/r6^n)^(1/n);	end;        	if abs_vel >= 5.34 then		rfriction_RR = r7;	end;        rfriction_RR = (rfriction_RR + r_extra)*sign(vel) + r_offset;implementation_end;        end;        connections         MUX\FL -> Wheel1\vel;         DEMUX\force -> fric_force;         wheel_vel -> MUX\input;         MUX\FR -> Wheel2\vel;         MUX\RR -> Wheel4\vel;         MUX\RL -> Wheel3\vel;         Wheel1\rfriction_FL -> DEMUX\FL;         Wheel2\rfriction_FR -> DEMUX\FR;         Wheel3\rfriction_RL -> DEMUX\RL;         Wheel4\rfriction_RR -> DEMUX\RR;        end;       implementation_end;      Gain 392 352       description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath>  <TimeStamp>2007-9-26 12:15:12</TimeStamp></Description>';       type Gain        ports         signal in input [6,1];         signal out output [6,1];       end;       icon bg bottom        figures         rectangle 376.1 336 407.9 368 fill 15132390;         text 'K' 392 352 color 16711680 16 bold;       end;       implementation eqparameters	real K[6] = [0.0;0.0;0.0;0.0;0.0;0.0];		// gainequations	output = diag(K) * input;    implementation_end;      GravityCompensationModel 1136 320       description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>youBot_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-21 10:13:56</TimeStamp></Description>';       type Submodel        ports         signal out joints [8,1];         signal in jointPos [8,1];        parameters         real InitialJointPos[5,1] = [0.0; 0.0; 0.0; 0.0; 0.0];         real LinkCOMdim[3,6] = [0.01489, 0.10453, 0.001, 0.011, 0.0, 0.0; 0.00213, 0.0017, 0.0967, 0.05103, 0.00115, 0.0; 0.00213, -0.00297, 0.02107, -0.02319, -0.01683, 0.001];         real Linkdim[3,6] = [0.024, 0.033, 0.0, 0.0, 0.0, 0.0; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0; 0.096, 0.019, 0.155, 0.135, 0.096, 0.034];         real Linkm[6,1] = [20.0; 2.412; 1.155; 0.934; 0.877; 1.121];       end;       icon bg        figures         rectangle 1081.5 281 1190.5 359 fill 11206638;         text '     youBot     GravityCompensation' 1134.5 321 16;       end;       implementation bg        submodels         Base 208 472          description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <LibraryPath>Link_GravityCompensation.emx</LibraryPath>  <TimeStamp>2011-1-19 11:37:47</TimeStamp><Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 20.0;            real COMdim[3,1] = [0.01489; 0.00213; 0.00213];            real dim[3,1] = [0.024; 0.0; 0.096];          end;          icon bg bottom           figures            rectangle 176 400 240 544 fill 10025880;            text 'LinkGC' 208 472;           terminals            p 176 432 fixed;            Hin 176 512 fixed;            p1 240 432 fixed;            Hout 240 512 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.01489; 0.00213; 0.00213];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 20.0;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;-9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.024; 0.0; 0.096];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         EffortSensor 536 64          description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\EffortSensor.emx</LibraryPath>  <TimeStamp>2007-9-27 9:59:27</TimeStamp></Description>';          knot EffortSensor           ports            power knot in p1 [8,1];            power knot out p2 [8,1];            signal knot out effort [8,1];           restrictions            causality constraint not_equal p1 p2;          end;          icon bg ellipse           figures            ellipse 529.1 58.3 542.9 72.4 fill 16777215;            text 'e' 536.5 62.6;          end;          implementation eqequations	p2.e = p1.e;	p1.f = p2.f;	effort = p1.e;implementation_end;         Hfloor0 112 512          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Sources\Constant.emx</LibraryPath> <TimeStamp>2007-10-19 14:48:44</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Constant           ports            signal out output [4,4];          end;          icon bg bottom           figures            rectangle 96.1 496 127.9 528 fill 15132390;            line 100.9 507.6 122.9 507.6 color 16711680 width 2;            line 98.2 518.7 123.9 518.7;            line 100.5 502.7 100.5 521;          end;          implementation eqequations	output = eye(4);     implementation_end;         Htip0 1088 512          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\SignalMonitor.emx</LibraryPath> <TimeStamp>2007-9-26 12:14:4</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type SignalMonitor           ports            signal in input [4,4];          end;          icon bg bottom           figures            rectangle 1072 496 1104 528 fill 15132390;            rectangle 1077.7 501.8 1098.3 522.6 color 16711680 fill 11776947 width 2;            rectangle 1079.8 504.4 1095.9 520 color -1 fill 16777215;            line 1081.9 506.7 1081.9 518 fill 16777215;            line 1080 516.4 1092.5 516.4 fill 16777215;            line 1081.5 516.1 1094.4 509.7 color 255 fill 16777215;          end;          implementation eq   implementation_end;         Joint12 448.2 472          description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <LibraryPath>Joint-roty_GravityCompensation.emx</LibraryPath>  <TimeStamp>2011-1-19 11:38:03</TimeStamp></Description>';          type 'Submodel-roty'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];            signal in angle;           parameters            real InitialPos = 0.0;          end;          icon bg bottom           figures            rectangle 416.4 400 479.9 544 fill 14745599;            text 'Joint-roty   GC' 448.4 475 fill 14745599;           terminals            p 415.9 432 fixed;            p1 447.4 400 fixed;            p2 479.9 432 fixed;            Hin 415.9 512 fixed;            Hout 479.9 512 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = 0.0;             end;             icon bg              figures               rectangle 304 320 336 352 fill 15132390;               text 'ò' 320 333.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = input;//int(input,init);R = [	cos(q),	0,	sin(q);			0,				1,	0;			-sin(q),	0,	cos(q)];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 496             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 480 335.9 512 fill 15132390;               text 'X' 320 496 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 56;            plug p2 496 424;            plug Hin 112 496;            plug Hout 504 496;            plug angle 320 208;            plug p 112 424;            OneJunction 240 272             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               power knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 272 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Tbai 240 384             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg left              figures               text '1' 240 384 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            uTbai 240 328             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'TF' 240 328 18 bold;             end;             implementation eqequations	p2.f = [0;p1.f;0;0;0;0];	p1.e = p2.e[2];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            p1 => ZeroJunction\p;            uTbai\p2 => Tbai\p;            Tbai\p => Wbai\p;            p <= Wbai\p;            ZeroJunction\p => OneJunction\p;            OneJunction\p => uTbai\p1;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            Splitter2\output -> AdHji\H 424 368;            angle -> Integrate\input;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 744 400;          implementation_end;         Joint23 608.2 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Joint-roty_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:38:03</TimeStamp></Description>';          type 'Submodel-roty'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];            signal in angle;           parameters            real InitialPos = 0.0;          end;          icon bg bottom           figures            rectangle 576.4 400 639.9 544 fill 14745599;            text 'Joint-roty   GC' 608.4 475 fill 14745599;           terminals            p 575.9 432 fixed;            p1 607.4 400 fixed;            p2 639.9 432 fixed;            Hin 575.9 512 fixed;            Hout 639.9 512 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = 0.0;             end;             icon bg              figures               rectangle 304 320 336 352 fill 15132390;               text 'ò' 320 333.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = input;//int(input,init);R = [	cos(q),	0,	sin(q);			0,				1,	0;			-sin(q),	0,	cos(q)];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 496             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 480 335.9 512 fill 15132390;               text 'X' 320 496 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 56;            plug p2 496 424;            plug Hin 112 496;            plug Hout 504 496;            plug angle 352 216;            plug p 112 424;            OneJunction 240 272             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               power knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 272 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Tbai 240 384             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg left              figures               text '1' 240 384 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            uTbai 240 328             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'TF' 240 328 18 bold;             end;             implementation eqequations	p2.f = [0;p1.f;0;0;0;0];	p1.e = p2.e[2];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            p1 => ZeroJunction\p;            uTbai\p2 => Tbai\p;            Tbai\p => Wbai\p;            p <= Wbai\p;            ZeroJunction\p => OneJunction\p;            OneJunction\p => uTbai\p1;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            Splitter2\output -> AdHji\H 424 368;            angle -> Integrate\input;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 744 400;          implementation_end;         Joint34 768.2 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Joint-roty_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:38:03</TimeStamp></Description>';          type 'Submodel-roty'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];            signal in angle;           parameters            real InitialPos = 0.0;          end;          icon bg bottom           figures            rectangle 736.4 400 799.9 544 fill 14745599;            text 'Joint-roty   GC' 768.4 475 fill 14745599;           terminals            p 735.9 432 fixed;            p1 767.4 400 fixed;            p2 799.9 432 fixed;            Hin 735.9 512 fixed;            Hout 799.9 512 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = 0.0;             end;             icon bg              figures               rectangle 304 320 336 352 fill 15132390;               text 'ò' 320 333.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = input;//int(input,init);R = [	cos(q),	0,	sin(q);			0,				1,	0;			-sin(q),	0,	cos(q)];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 496             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 480 335.9 512 fill 15132390;               text 'X' 320 496 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 56;            plug p2 496 424;            plug Hin 112 496;            plug Hout 504 496;            plug angle 336 216;            plug p 112 424;            OneJunction 240 272             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               power knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 272 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Tbai 240 384             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg left              figures               text '1' 240 384 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            uTbai 240 328             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'TF' 240 328 18 bold;             end;             implementation eqequations	p2.f = [0;p1.f;0;0;0;0];	p1.e = p2.e[2];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            p1 => ZeroJunction\p;            uTbai\p2 => Tbai\p;            Tbai\p => Wbai\p;            p <= Wbai\p;            ZeroJunction\p => OneJunction\p;            OneJunction\p => uTbai\p1;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            angle -> Integrate\input;            Splitter2\output -> AdHji\H 424 368;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 744 400;          implementation_end;         Joint45 928.2 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Joint-rotz_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:54</TimeStamp></Description>';          type 'Submodel-rotz'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];            signal in angle;           parameters            real InitialPos = 0.0;          end;          icon bg bottom           figures            rectangle 896.4 400 959.9 544 fill 14745599;            text 'Joint-rotz   GC' 928.4 475 fill 14745599;           terminals            p 895.9 432 fixed;            p1 927.4 400 fixed;            p2 959.9 432 fixed;            Hin 895.9 512 fixed;            Hout 959.9 512 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 288             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = 0.0;             end;             icon bg              figures               rectangle 304 272 336 304 fill 15132390;               text 'ò' 320 285.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = input;//int(input,init);R = [	cos(-q),	-sin(-q),	0;			sin(-q),	cos(-q),	0;			0,				0,				1];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 576             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 560 335.9 592 fill 15132390;               text 'X' 320 576 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 40;            plug p2 496 424;            plug Hin 112 576;            plug Hout 504 576;            plug angle 336 184;            plug p 112 424;            OneJunction 240 288             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               mechanical knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 288 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            uTbai 240 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;               causality fixed out p1;               causality fixed in p2;             end;             icon bg left              figures               text 'TF' 240 336 18 bold;             end;             implementation eqequations	p1.e = p2.e[3];	p2.f = [0;0;p1.f;0;0;0];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               mechanical knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            uTbai\p1 <= OneJunction\p;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            ZeroJunction\p => OneJunction\p;            p1 => ZeroJunction\p;            uTbai\p2 => Wbai\p;            p <= Wbai\p;            Splitter2\output -> AdHji\H 424 368;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            angle -> Integrate\input;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 680 488;          implementation_end;         JointBase1 288.2 472          description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <LibraryPath>Joint-rotz_GravityCompensation.emx</LibraryPath>  <TimeStamp>2011-1-21 10:09:48</TimeStamp></Description>';          type 'Submodel-rotz'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];            signal in angle;           parameters            real InitialPos = 0.0;          end;          icon bg bottom           figures            rectangle 256.4 400 319.9 544 fill 14745599;            text 'Joint-rotz   GC' 288.4 475 fill 14745599;           terminals            p 255.9 432 fixed;            p1 287.4 400 fixed;            p2 319.9 432 fixed;            Hin 255.9 512 fixed;            Hout 319.9 512 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 288             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = 0.0;             end;             icon bg              figures               rectangle 304 272 336 304 fill 15132390;               text 'ò' 320 285.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = input;//int(input,init);R = [	cos(-q),	-sin(-q),	0;			sin(-q),	cos(-q),	0;			0,				0,				1];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 576             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 560 335.9 592 fill 15132390;               text 'X' 320 576 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 40;            plug p2 496 424;            plug Hin 112 576;            plug Hout 504 576;            plug angle 320 216;            plug p 112 424;            OneJunction 240 288             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               mechanical knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 288 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            uTbai 240 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;               causality fixed out p1;               causality fixed in p2;             end;             icon bg left              figures               text 'TF' 240 336 18 bold;             end;             implementation eqequations	p1.e = p2.e[3];	p2.f = [0;0;p1.f;0;0;0];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               mechanical knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            uTbai\p1 <= OneJunction\p;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            ZeroJunction\p => OneJunction\p;            p1 => ZeroJunction\p;            uTbai\p2 => Wbai\p;            p <= Wbai\p;            Splitter2\output -> AdHji\H 424 368;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            angle -> Integrate\input;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 680 488;          implementation_end;         Link1 368 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 2.412;            real COMdim[3,1] = [0.10453; 0.0017; -0.00297];            real dim[3,1] = [0.033; 0.0; 0.019];          end;          icon bg bottom           figures            rectangle 336 400 400 544 fill 10025880;            text 'LinkGC' 368 472;           terminals            p 336 432 fixed;            Hin 336 512 fixed;            p1 400 432 fixed;            Hout 400 512 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.10453; 0.0017; -0.00297];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 2.412;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;-9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.033; 0.0; 0.019];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link2 528 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 1.155;            real COMdim[3,1] = [0.001; 0.0967; 0.02107];            real dim[3,1] = [0.0; 0.0; 0.155];          end;          icon bg bottom           figures            rectangle 496 400 560 544 fill 10025880;            text 'LinkGC' 528 472;           terminals            p 496 432 fixed;            Hin 496 512 fixed;            p1 560 432 fixed;            Hout 560 512 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.001; 0.0967; 0.02107];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 1.155;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;-9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.155];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link3 688 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 0.934;            real COMdim[3,1] = [0.011; 0.05103; -0.02319];            real dim[3,1] = [0.0; 0.0; 0.135];          end;          icon bg bottom           figures            rectangle 656 400 720 544 fill 10025880;            text 'LinkGC' 688 472;           terminals            p 656 432 fixed;            Hin 656 512 fixed;            p1 720 432 fixed;            Hout 720 512 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.011; 0.05103; -0.02319];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 0.934;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;-9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.135];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link4 848 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 0.877;            real COMdim[3,1] = [0.0; 0.00115; -0.01683];            real dim[3,1] = [0.0; 0.0; 0.096];          end;          icon bg bottom           figures            rectangle 816 400 880 544 fill 10025880;            text 'LinkGC' 848 472;           terminals            p 816 432 fixed;            Hin 816 512 fixed;            p1 880 432 fixed;            Hout 880 512 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.0; 0.00115; -0.01683];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 0.877;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;-9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.096];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link5 1008 472          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 1.121;            real COMdim[3,1] = [0.0; 0.0; 0.001];            real dim[3,1] = [0.0; 0.0; 0.034];          end;          icon bg bottom           figures            rectangle 976 400 1040 544 fill 10025880;            text 'LinkGC' 1008 472;           terminals            p 976 432 fixed;            Hin 976 512 fixed;            p1 1040 432 fixed;            Hout 1040 512 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.0; 0.0; 0.001];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 1.121;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;-9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.034];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Mux 536 161          description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Submodel           ports            power out port [8,1];            power out port5;            power out port6;            power out port7;            power out port8;            power out port9;           restrictions            causality fixed in port8;            causality fixed in port9;            causality fixed in port5;            causality fixed in port6;            causality fixed in port7;            causality fixed out port;          end;          icon bg           figures            rectangle 456 146 616 176 fill 14013909;            text 'Mux' 536 160 16;           terminals            port 536 144 fixed;            port5 536 176 fixed;            port6 552 176 fixed;            port7 568 176 fixed;            port8 584 176 fixed;            port9 600 176 fixed;          end;          implementation eqparameters	real calibartion=1;equations	port.e[1] = 0;	port.e[2] = 0;	port.e[3] = 0;	port.e[4] = port5.e*calibartion;	port.e[5] = port6.e*calibartion;	port.e[6] = port7.e*calibartion;	port.e[7] = port8.e*calibartion;	port.e[8] = port9.e*calibartion;		port5.f = port.f[4];	port6.f = port.f[5];	port7.f = port.f[6];	port8.f = port.f[7];	port9.f = port.f[8];implementation_end;         plug jointPos 80 648;         plug joints 760 64;         Submodel13 608 648          description '<Description> <Version>4.0</Version>   <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath>  <TimeStamp>2007-10-31 11:32:54</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';          type Submodel           ports            signal in jointPos [8,1];            signal out port1;            signal out port2;            signal out port3;            signal out port4;            signal out port5;          end;          implementation eqequationsport1=jointPos[4];port2=jointPos[5];port3=jointPos[6];port4=jointPos[7];port5=jointPos[8];implementation_end;         Wtip0 1080 432          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Se           ports            power out p [6,1];           restrictions            causality fixed out p;          end;          icon bg bottom           figures            text 'Se' 1080 432 18 bold;          end;          implementation eqparameters	real effort = 0;variables	real flow[6];equations	p.e = effort;	flow = p.f;implementation_end;         ZeroJunction 112 432          description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';          knot ZeroJunction           ports            power knot duplicatable none p [6,1];            signal knot out effort [6,1];           restrictions            causality constraint one_in p;          end;          icon bg           figures            text '0' 112 432 18 bold;          end;          implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;         ZeroJunction1 488 64          description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';          knot ZeroJunction           ports            power knot duplicatable none p [8,1];            signal knot out effort [8,1];           restrictions            causality constraint one_in p;          end;          icon bg           figures            text '0' 488 64 18 bold;          end;          implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;        end;        connections         Base\p => ZeroJunction\p;         JointBase1\p2 <= Link1\p;         Joint12\p => Link1\p1;         Joint12\p2 <= Link2\p;         Joint23\p => Link2\p1;         Joint23\p2 <= Link3\p;         Joint34\p => Link3\p1;         Link4\p => Joint34\p2;         Joint45\p => Link4\p1;         Mux\port => EffortSensor\p1;         Link5\p => Joint45\p2;         JointBase1\p1 <= Mux\port5 288 272 536 272;         EffortSensor\p2 => ZeroJunction1\p;         Joint12\p1 <= Mux\port6 448 288 552 288;         JointBase1\p => Base\p1;         Wtip0\p => Link5\p1;         Mux\port7 => Joint23\p1 568 224 608 224;         Mux\port8 => Joint34\p1 584 208 768 208;         Mux\port9 => Joint45\p1 600 192 928 192;         Hfloor0\output -> Base\Hin;         Joint45\Hin <- Link4\Hout;         jointPos -> Submodel13\jointPos;         Submodel13\port1 -> JointBase1\angle 288 608;         Submodel13\port2 -> Joint12\angle 448 592;         Submodel13\port3 -> Joint23\angle;         Submodel13\port4 -> Joint34\angle 768 600;         Submodel13\port5 -> Joint45\angle 928 608;         Joint34\Hout -> Link4\Hin;         Joint34\Hin <- Link3\Hout;         Link3\Hin <- Joint23\Hout;         Link2\Hout -> Joint23\Hin;         EffortSensor\effort -> joints;         Link2\Hin <- Joint12\Hout;         Joint12\Hin <- Link1\Hout;         Base\Hout -> JointBase1\Hin;         Htip0\input <- Link5\Hout;         Link1\Hin <- JointBase1\Hout;         Joint45\Hout -> Link5\Hin;        end;        parameterrelationsBase\m = Linkm[1];Base\COMdim = LinkCOMdim[1:3,1];Base\dim = Linkdim[1:3,1];Link1\m = Linkm[2];Link1\COMdim = LinkCOMdim[1:3,2];Link1\dim = Linkdim[1:3,2];Link2\m = Linkm[3];Link2\COMdim = LinkCOMdim[1:3,3];Link2\dim = Linkdim[1:3,3];Link3\m = Linkm[4];Link3\COMdim = LinkCOMdim[1:3,4];Link3\dim = Linkdim[1:3,4];Link4\m = Linkm[5];Link4\COMdim = LinkCOMdim[1:3,5];Link4\dim = Linkdim[1:3,5];Link5\m = Linkm[6];Link5\COMdim = LinkCOMdim[1:3,6];Link5\dim = Linkdim[1:3,6];JointBase1\InitialPos = InitialJointPos[1];Joint12\InitialPos = InitialJointPos[2];Joint23\InitialPos = InitialJointPos[3];Joint34\InitialPos = InitialJointPos[4];Joint45\InitialPos = InitialJointPos[5];parameterrelations_end;       implementation_end;      Integrate 1592 256       description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath>  <TimeStamp>2007-9-26 12:3:23</TimeStamp></Description>';       type Integrate        ports         signal in input [3,1];         signal out output [3,1];       end;       icon bg bottom        figures         rectangle 1576 240 1608 272 fill 15132390;         text 'ò' 1592 253.3 color 16711680 'SymbolProp BT' 21 symbol;       end;       implementation eqvariables	real initial[4,4];		// initial value	//real W[3,1], V[3,1];	real complete_twist[6,1];	real T_tilde[4,4];	real H_dot[4,4];	real H[4,4];	real pitch,yaw;initialequations	initial = eye(4);	H = eye(4);	H_dot = eye(4);code	//W = [0; 0; input[1]];	//V = [input[3]; input[2]; 0];	//T_tilde = tilde(W,V);	complete_twist = [0; 0; input[1]; input[2]; input[3]; 0];	T_tilde = tilde(complete_twist);	H_dot = H*T_tilde;	H = int(H_dot, initial);		output[2] = H[1,4];	output[3] = H[2,4];	//pitch =  arcsin(limit(H[3,1],-1,1));	//pitch = atan2(-H[3,1],sqrt(H[1,1]^2+H[2,1]^2));	//yaw = atan2(H[2,1]/cos(pitch),H[1,1]/cos(pitch));	yaw = atan2(H[2,1],H[1,1]);	if yaw < 0 then		yaw = yaw + 2*pi;	end;	output[1] = yaw;implementation_end;      JointSoftLimits 976 376       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Control\PID Control\Continuous\P.emx</LibraryPath> <TimeStamp>2008-1-17 10:48:8</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type P        ports         signal in error [8,1];         signal out output [8,1];       end;       icon bg right        figures         text 'P' 976.5 376.1 color 16711680 18 bold;         group          rectangle 960 360 992 392 fill 15132390;          line 964.5 375.9 989 375.9 fill 15132390;          line 976.2 363 976.2 388.7 fill 15132390;          spline 983.1 369.9 969.4 381.9 color 16711680 fill 15132390 width 2;          spline 970.2 381.3 969.8 389.9 color 16711680 fill 15132390 width 2;          spline 983.6 363 983.1 369.9 color 16711680 fill 15132390 width 2;         end;       end;       implementation eqparameters 	real c[8]= [0.0;0.0;0.0;50.0;50.0;50.0;50.0;50.0];	real limits_low[8]= [ -10;-10;-10;-2.9395 ; -1.1244 ; -2.4733;  -1.7668 ; -2.8127];  	real limits_high[8]= [ 10;10;10;2.8847   ;1.4809  ; 2.5325  ; 1.6368 ;  2.7125];	real working_range= 0.95;variables	real substate[8];	real angle_limits_low[8];	real angle_limits_high[8];code  angle_limits_low=working_range*limits_low;  angle_limits_high=working_range*limits_high;  substate[1]=(limit(error[1]-angle_limits_high[1],0,10))+(limit(error[1]-angle_limits_low[1],-10,0));  substate[2]=(limit(error[2]-angle_limits_high[2],0,10))+(limit(error[2]-angle_limits_low[2],-10,0));  substate[3]=(limit(error[3]-angle_limits_high[3],0,10))+(limit(error[3]-angle_limits_low[3],-10,0));  substate[4]=(limit(error[4]-angle_limits_high[4],0,10))+(limit(error[4]-angle_limits_low[4],-10,0));  substate[5]=(limit(error[5]-angle_limits_high[5],0,10))+(limit(error[5]-angle_limits_low[5],-10,0));  substate[6]=(limit(error[6]-angle_limits_high[6],0,10))+(limit(error[6]-angle_limits_low[6],-10,0));  substate[7]=(limit(error[7]-angle_limits_high[7],0,10))+(limit(error[7]-angle_limits_low[7],-10,0));  substate[8]=(limit(error[8]-angle_limits_high[8],0,10))+(limit(error[8]-angle_limits_low[8],-10,0));   output = -diag(c)*substate;implementation_end;      JointSpaceDamping 712 368       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Control\PID Control\Continuous\P.emx</LibraryPath> <TimeStamp>2008-1-17 10:48:8</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type P        ports         signal in error [8,1];         signal out output [8,1];       end;       icon bg right        figures         rectangle 696 352 728 384 fill 15132390;         text 'P' 712.5 368.1 color 16711680 18 bold;       end;       implementation eqparameters	real r[8]= [0.0;0.0;0.0;0.0;0.0;0.0;0.0;0.0];variables	real R[8,8] ;	real substate[8];//always positive or zeroequations	R=diag(r);						output =-R*error;//(p_substate+n_substate);// R * p.f;implementation_end;      JointSpaceStiffness 840 336       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Control\PID Control\Continuous\P.emx</LibraryPath> <TimeStamp>2008-1-17 10:48:8</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type P        ports         signal in error [8,1];         signal out output [8,1];         signal in jnt_stiffness [8,1];       end;       icon bg right        figures         rectangle 824 320 856 352 fill 15132390;         text 'P' 840.5 336.1 color 16711680 18 bold;       end;       implementation eqparameters	real c[8] = [0.0;0.0;0.0;0.0;0.0;0.0;0.0;0.0];//real setpoints[8]=[0;0;0;0;0;0;0;0];	real force_lim=10;variables	 real x[8];	 real substate[8];equations 	output=diag(jnt_stiffness)*(error);implementation_end;      Limit1 840 376       description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram Non-Linear\SignalLimiter-Limit.emx</LibraryPath>  <TimeStamp>2007-9-26 12:47:40</TimeStamp></Description>';       type 'SignalLimiter-Limit'        ports         signal in input [8,1];         signal out output [8,1];       end;       icon bg right        figures         group          rectangle 824 360 856 392 fill 15132390;          line 839.9 364.5 839.9 389 fill 15132390;          line 827 376.2 852.7 376.2 fill 15132390;          spline 833.9 383.1 845.9 369.4 color 16711680 fill 15132390 width 2;          spline 845.3 370.2 853.9 369.8 color 16711680 fill 15132390 width 2;          spline 827 383.6 833.9 383.1 color 16711680 fill 15132390 width 2;         end;       end;       implementation eqparameters	real force_lim = 10;equations	output[1]=(limit(input[1],-force_lim,force_lim));	output[2]=(limit(input[2],-force_lim,force_lim));	output[3]=(limit(input[3],-force_lim,force_lim));	output[4]=(limit(input[4],-force_lim,force_lim));	output[5]=(limit(input[5],-force_lim,force_lim));	output[6]=(limit(input[6],-force_lim,force_lim));	output[7]=(limit(input[7],-force_lim,force_lim));	output[8]=(limit(input[8],-force_lim,force_lim));implementation_end;      Limit3 608 424       description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram Non-Linear\SignalLimiter-Limit.emx</LibraryPath>  <TimeStamp>2007-9-26 12:47:40</TimeStamp></Description>';       type 'SignalLimiter-Limit'        ports         signal in input [8,1];         signal out output [8,1];       end;       icon bg bottom        figures         group          rectangle 592 408 624 440 fill 15132390;          line 607.9 412.5 607.9 437 fill 15132390;          line 595 424.2 620.7 424.2 fill 15132390;          spline 601.9 431.1 613.9 417.4 color 16711680 fill 15132390 width 2;          spline 613.3 418.2 621.9 417.8 color 16711680 fill 15132390 width 2;          spline 595 431.6 601.9 431.1 color 16711680 fill 15132390 width 2;         end;       end;       implementation eqparameters	real force_lim = 10;equations	output[1]=(limit(input[1],-force_lim,force_lim));	output[2]=(limit(input[2],-force_lim,force_lim));	output[3]=(limit(input[3],-force_lim,force_lim));	output[4]=(limit(input[4],-force_lim,force_lim));	output[5]=(limit(input[5],-force_lim,force_lim));	output[6]=(limit(input[6],-force_lim,force_lim));	output[7]=(limit(input[7],-force_lim,force_lim));	output[8]=(limit(input[8],-force_lim,force_lim));implementation_end;      Link_map 1576 512       description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type Submodel        ports         signal in virtual_twist [3,1];         signal out wheel_torques [4,1];         signal in joint_vel [4,1];         signal out virtual_vel [3,1];       end;       icon bg        figures         rectangle 1539 490 1613 534 fill 14013909;         text 'name' 1576 512 16;        terminals         joint_vel 1560 488 fixed;         virtual_vel 1592 488 fixed;       end;       implementation eqparameters	real r = 0.047;	real x = 0.235;	real y = 0.15;variables	real A[3,4];	real PseudoInverseA[4,3];equations	A =  (1/(2*r))*	[ 	x+y 	,x+y	,x+y	,x+y;		-1		, 1	,-1	, 1;		1		, 1	,-1	,- 1];		PseudoInverseA = transpose(A)*inverse(A*transpose(A));	wheel_torques = PseudoInverseA*virtual_twist;	virtual_vel = transpose(PseudoInverseA)*joint_vel;implementation_end;      Mux 1320 384       description '<Description> <Version>4.0</Version> <LibraryPath>Template\Submodel-Equation.emx</LibraryPath> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <TimeStamp>2007-11-1 22:32:1</TimeStamp> <AllowLibraryUpdate>False</AllowLibraryUpdate></Description>';       type 'Submodel-Equation'        ports         signal out joint_states [8,1];         signal in Arm1_joint_states [5,1];         signal in measured_odometry [3,1];         signal in Arm1_joint_velocites [5,1];         signal out joints_velocities [8,1];         signal in base_joint_velocities [4,1];         signal out Arm1_joint_cmd [5,1];         signal out Base_twist_cmd [3,1];         signal in cmd [8,1];         signal out Base_twist [6,1];       end;       icon bg        figures         rectangle 1287 316 1353 452 fill 14013909;         text 'name' 1321 364 16;        terminals         joint_states 1288 360 fixed;         Arm1_joint_states 1352 344 fixed;         measured_odometry 1352 328 fixed;         Arm1_joint_velocites 1352 376 fixed;         joints_velocities 1288 344 fixed;         base_joint_velocities 1352 360 fixed;         Arm1_joint_cmd 1352 416 fixed;         Base_twist_cmd 1352 432 fixed;         cmd 1288 424 fixed;       end;       implementation eqparameters	real joints_initial_states[5]=[-2.9496; -1.13; 2.5482; -1.789; -2.9234];equations		//Output	Base_twist_cmd = cmd[1:3];	Arm1_joint_cmd = cmd[4:8];	//Input	joints_velocities[1:3]=0;	joints_velocities[4:8]=Arm1_joint_velocites;	joint_states[1:3]=measured_odometry;	joint_states[4:8]=Arm1_joint_states+joints_initial_states;	Base_twist = [Base_twist_cmd[3]; Base_twist_cmd[2]; 0; 0; 0; Base_twist_cmd[1]]; implementation_end;      plug Htip0 232 272;      plug JntSpaceStiffness 904 296;      plug JointSpaceSetpoint 760 72;      plug HtipCC 40 440;      plug CartSpaceStiffness 72 408;      plug Hvp0 32 424;      plug Base_joint_states 1816 232;      plug Base_torque_cmd 1944 512;      plug Base_twist 1624 600;      plug Arm1_joint_states 1464 344;      plug Wtip0 352 536;      plug Base_twist_cmd 1464 432;      plug Arm1_joint_cmd 1464 416;      plug Base_joint_velocities 1688 360;      plug Arm1_joint_velocites 1472 376;      plug Measured_odometry 1472 328;      plug JointStates 1304 232;      PlusMinus1 1136 424       description '<Description><Version>4.0</Version><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\PlusMinus.emx</LibraryPath>  <TimeStamp>2007-9-27 10:15:13</TimeStamp></Description>';       knot PlusMinus        ports         signal knot duplicatable in plus [8,1];         signal knot duplicatable in minus [8,1];         signal knot out output [8,1];       end;       icon bg ellipse        figures         ellipse 1128 416 1144 432 fill 16777215;       end;       implementation eqequations    output = sum (collect (plus)) - sum (collect (minus));    implementation_end;      PlusMinus2 840 296       description '<Description><Version>4.0</Version><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\PlusMinus.emx</LibraryPath>  <TimeStamp>2007-9-27 10:15:13</TimeStamp></Description>';       knot PlusMinus        ports         signal knot duplicatable in plus [8,1];         signal knot duplicatable in minus [8,1];         signal knot out output [8,1];       end;       icon bg ellipse        figures         ellipse 832 288 848 304 fill 16777215;       end;       implementation eqequations    output = sum (collect (plus)) - sum (collect (minus));    implementation_end;      PlusMinus3 840 424       description '<Description><Version>4.0</Version><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\PlusMinus.emx</LibraryPath>  <TimeStamp>2007-9-27 10:15:13</TimeStamp></Description>';       knot PlusMinus        ports         signal knot duplicatable in plus [8,1];         signal knot duplicatable in minus [8,1];         signal knot out output [8,1];       end;       icon bg ellipse        figures         ellipse 832 416 848 432 fill 16777215;       end;       implementation eqequations    output = sum (collect (plus)) - sum (collect (minus));    implementation_end;      PlusMinus4 976 424       description '<Description><Version>4.0</Version><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\PlusMinus.emx</LibraryPath>  <TimeStamp>2007-9-27 10:15:13</TimeStamp></Description>';       knot PlusMinus        ports         signal knot duplicatable in plus [8,1];         signal knot duplicatable in minus [8,1];         signal knot out output [8,1];       end;       icon bg ellipse        figures         ellipse 968 416 984 432 fill 16777215;       end;       implementation eqequations    output = sum (collect (plus)) - sum (collect (minus));    implementation_end;      PlusMinus5 712 424       description '<Description><Version>4.0</Version><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\PlusMinus.emx</LibraryPath>  <TimeStamp>2007-9-27 10:15:13</TimeStamp></Description>';       knot PlusMinus        ports         signal knot duplicatable in plus [8,1];         signal knot duplicatable in minus [8,1];         signal knot out output [8,1];       end;       icon bg ellipse        figures         ellipse 704 416 720 432 fill 16777215;       end;       implementation eqequations    output = sum (collect (plus)) - sum (collect (minus));    implementation_end;      PlusMinus6 392 424       description '<Description><Version>4.0</Version><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\PlusMinus.emx</LibraryPath>  <TimeStamp>2007-9-27 10:15:13</TimeStamp></Description>';       knot PlusMinus        ports         signal knot duplicatable in plus [6,1];         signal knot duplicatable in minus [6,1];         signal knot out output [6,1];       end;       icon bg ellipse        figures         ellipse 384 416 400 432 fill 16777215;       end;       implementation eqequations    output = sum (collect (plus)) - sum (collect (minus));    implementation_end;      PlusMinus7 1816 512       description '<Description><Version>4.0</Version><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Signal\Block Diagram\PlusMinus.emx</LibraryPath>  <TimeStamp>2007-9-27 10:15:13</TimeStamp></Description>';       knot PlusMinus        ports         signal knot duplicatable in plus [4,1];         signal knot duplicatable in minus [4,1];         signal knot out output [4,1];       end;       icon bg ellipse        figures         ellipse 1808 504 1824 520 fill 16777215;       end;       implementation eqequations    output = sum (collect (plus)) - sum (collect (minus));    implementation_end;      Splitter1 1136 256       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [8,1];         signal knot in input [8,1];       end;       icon bg ellipse        figures         ellipse 1132.8 252.8 1139.2 259.2 color -1 fill 0;         ellipse 1131.7 251.7 1140.3 260.3 color -1;        terminals         input 1136 256 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter10 1384 512       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [3,1];         signal knot in input [3,1];       end;       icon bg ellipse        figures         ellipse 1380.8 508.8 1387.2 515.2 color -1 fill 0;         ellipse 1379.7 507.7 1388.3 516.3 color -1;        terminals         input 1384 512 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter11 1560 360       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [4,1];         signal knot in input [4,1];       end;       icon bg ellipse        figures         ellipse 1556.8 356.8 1563.2 363.2 color -1 fill 0;         ellipse 1555.7 355.7 1564.3 364.3 color -1;        terminals         input 1560 360 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter14 288 272       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [4,4];         signal knot in input [4,4];       end;       icon bg ellipse        figures         ellipse 284.8 268.8 291.2 275.2 color -1 fill 0;         ellipse 283.7 267.7 292.3 276.3 color -1;        terminals         input 288 272 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter15 1256 232       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [8,1];         signal knot in input [8,1];       end;       icon bg ellipse        figures         ellipse 1252.8 228.8 1259.2 235.2 color -1 fill 0;         ellipse 1251.7 227.7 1260.3 236.3 color -1;        terminals         input 1256 232 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter2 976 256       description '<Description> <Version>4.0</Version> <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath> <TimeStamp>2008-01-17 11:28:29</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       knot Splitter        ports         signal knot duplicatable out output [8,1];         signal knot in input [8,1];       end;       icon bg ellipse        figures         ellipse 972.8 252.8 979.2 259.2 color -1 fill 0;         ellipse 971.7 251.7 980.3 260.3 color -1;        terminals         input 976 256 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter4 840 256       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [8,1];         signal knot in input [8,1];       end;       icon bg ellipse        figures         ellipse 836.8 252.8 843.2 259.2 color -1 fill 0;         ellipse 835.7 251.7 844.3 260.3 color -1;        terminals         input 840 256 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter6 1240 256       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [8,1];         signal knot in input [8,1];       end;       icon bg ellipse        figures         ellipse 1236.8 252.8 1243.2 259.2 color -1 fill 0;         ellipse 1235.7 251.7 1244.3 260.3 color -1;        terminals         input 1240 256 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter7 544 312       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [6,8];         signal knot in input [6,8];       end;       icon bg ellipse        figures         ellipse 540.8 308.8 547.2 315.2 color -1 fill 0;         ellipse 539.7 307.7 548.3 316.3 color -1;        terminals         input 544 312 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter8 352 424       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [6,1];         signal knot in input [6,1];       end;       icon bg ellipse        figures         ellipse 348.8 420.8 355.2 427.2 color -1 fill 0;         ellipse 347.7 419.7 356.3 428.3 color -1;        terminals         input 352 424 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      Splitter9 1384 432       description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';       knot Splitter        ports         signal knot duplicatable out output [3,1];         signal knot in input [3,1];       end;       icon bg ellipse        figures         ellipse 1380.8 428.8 1387.2 435.2 color -1 fill 0;         ellipse 1379.7 427.7 1388.3 436.3 color -1;        terminals         input 1384 432 fixed;       end;       implementation eqequations    collect (output) = input;implementation_end;      TF 544 424       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type Gain        ports         signal in Jacobian [6,8];         signal out joints_e [8,1];         signal in tip_e [6,1];       end;       icon bg bottom        figures         rectangle 528.1 408 559.9 440 fill 15132390;         text 'TF' 544 424 color 16711680 16 bold;       end;       implementation eqequations	joints_e= transpose(Jacobian)*tip_e;	implementation_end;      TF1 496 352       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type Gain        ports         signal in Jacobian [6,8];         signal in joints_f [8,1];         signal out tip_f [6,1];       end;       icon bg bottom        figures         rectangle 480.1 336 511.9 368 fill 15132390;         text 'TF' 496 352 color 16711680 16 bold;       end;       implementation eqequationstip_f=Jacobian*joints_f;	implementation_end;     end;     connections      JointSpaceDamping\output -> PlusMinus5\plus;      Splitter6\output -> Differentiate\input 1240 136;      GravityCompensationModel\joints -> PlusMinus1\plus;      JointSpaceStiffness\output -> Limit1\input;      CalculateJ\Htip0 -> Splitter14\input;      CalculateJ\controllableJ -> Splitter7\input;      Splitter14\output -> Htip0;      JntSpaceStiffness -> JointSpaceStiffness\jnt_stiffness;      Splitter15\output -> JointStates;      Limit1\output -> PlusMinus3\plus;      Differentiate\output -> TF1\joints_f 632 136 632 352;      Complete_twist\Base_twist -> Base_twist;      Base_joint_states -> Differentiate1\input;      Arm1_joint_states -> Mux\Arm1_joint_states;      JointSpaceSetpoint -> PlusMinus2\plus 760 296;      Mux\Arm1_joint_cmd -> Arm1_joint_cmd;      Deadzone\output -> JointSpaceDamping\error;      Splitter8\output -> Wtip0;      CartSpaceStiffness -> CartesianSpaceStiffness\cart_stiffness;      TF\joints_e -> Limit3\input;      Splitter8\output -> PlusMinus6\plus;      Gain\output -> PlusMinus6\minus;      Splitter15\output -> Deadzone\input 1256 232 712 232;      Differentiate1\output -> Fric_comp\wheel_vel;      Arm1_joint_velocites -> Mux\Arm1_joint_velocites;      TF1\tip_f -> Gain\input;      Mux\Base_twist_cmd -> Splitter9\input;      HtipCC -> CartesianSpaceStiffness\HtipCC;      Splitter6\output -> Splitter1\input 1240 256;      Splitter2\output -> Splitter4\input;      Splitter1\output -> GravityCompensationModel\jointPos;      Splitter7\output -> TF1\Jacobian 496 312;      Splitter11\output -> Mux\base_joint_velocities;      Fric_comp\fric_force -> PlusMinus7\plus;      JointSoftLimits\output -> PlusMinus4\plus;      PlusMinus3\output -> PlusMinus4\plus;      PlusMinus7\output -> Base_torque_cmd;      Splitter7\output -> TF\Jacobian;      CartesianSpaceStiffness\effort -> Splitter8\input;      Mux\joint_states -> Splitter6\input 1240 360;      Splitter2\output -> JointSoftLimits\error;      Splitter4\output -> PlusMinus2\minus;      PlusMinus2\output -> JointSpaceStiffness\error;      Splitter10\output -> Link_map\virtual_twist 1384 512;      Link_map\wheel_torques -> PlusMinus7\plus;      Splitter11\output -> Link_map\joint_vel;      Splitter1\output -> Splitter2\input;      PlusMinus5\output -> PlusMinus3\plus;      PlusMinus1\output -> Mux\cmd;      Integrate\output -> Mux\measured_odometry;      Limit3\output -> PlusMinus5\plus;      PlusMinus6\output -> TF\tip_e;      Splitter9\output -> Base_twist_cmd;      Link_map\virtual_vel -> Integrate\input;      PlusMinus4\output -> PlusMinus1\plus;      Hvp0 -> CartesianSpaceStiffness\Hvp0;      Splitter10\output -> Complete_twist\Base_twist_cmd 1384 600;      Mux\joints_velocities -> Splitter15\input 1256 344;      Base_joint_velocities -> Splitter11\input;      Splitter4\output -> CalculateJ\jointVelocities;      Splitter9\output -> Splitter10\input;      Splitter14\output -> CartesianSpaceStiffness\Htip0 288 272;     end;     figures      rectangle 1069.5 264 1200 488 fill 15132390;      rectangle 136 200 432 488 fill 16443110;      rectangle 444 192 656 488 fill 9143144;      rectangle 664.5 187 1063.5 485 fill 16443110;      text 'Controllers / Code generation' 264 168 16;      text 'Cartesian Space' 272 208 16;      text 'Joint Space' 720 208 16;      text 'Kinematic' 616 208 16;    implementation_end;   youBot_RTT_test 544 224    description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';    type Submodel     ports      signal in Base_twist_cmd [3,1];      signal in Arm1_joint_cmd [5,1];      signal out Arm1_joint_states [5,1];      signal out Base_odometry_state [3,1];      signal out Arm1_joint_velocities [5,1];      signal out Base_joint_velocities [4,1];      signal out Base_joint_states [4,1];      signal in Base_joint_cmd [4,1];    end;    icon bg bottom     figures      rectangle 504.1 153.6 583.9 294.4 fill 14013909;      text 'name' 543.6 179.1;     terminals      Base_twist_cmd 504 264 fixed;      Arm1_joint_cmd 504 248 fixed;      Arm1_joint_states 504 184 fixed;      Base_odometry_state 504 168 fixed;      Arm1_joint_velocities 504 216 fixed;      Base_joint_velocities 504 200 fixed;      Base_joint_states 504 232 fixed;      Base_joint_cmd 504 280 fixed;    end;    implementation bg     submodels      GravityImitation 608 136       description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>youBot_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-21 10:13:56</TimeStamp></Description>';       type Submodel        ports         power out joints [9,1];        parameters         real InitialJointPos[5,1] = [-2.9496; -1.13; 2.5482; -1.789; -2.9234];         real LinkCOMdim[3,6] = [0.01489, 0.10453, 0.001, 0.011, 0.0, 0.0; 0.00213, 0.0017, 0.0967, 0.05103, 0.00115, 0.0; 0.00213, -0.00297, 0.02107, -0.02319, -0.01683, 0.001];         real Linkdim[3,6] = [0.024, 0.033, 0.0, 0.0, 0.0, 0.0; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0; 0.096, 0.019, 0.155, 0.135, 0.096, 0.034];         real Linkm[6,1] = [20.0; 2.412; 1.155; 0.934; 0.877; 1.121];       end;       icon bg bottom        figures         rectangle 553.5 97 662.5 175 fill 11206638;         text 'youBotGravity' 606.5 137 16;       end;       implementation bg        submodels         Base 368 504          description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <LibraryPath>Link_GravityCompensation.emx</LibraryPath>  <TimeStamp>2011-1-19 11:37:47</TimeStamp><Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 20.0;            real COMdim[3,1] = [0.01489; 0.00213; 0.00213];            real dim[3,1] = [0.024; 0.0; 0.096];          end;          icon bg bottom           figures            rectangle 336 432 400 576 fill 10025880;            text 'LinkGC' 368 504;           terminals            p 336 464 fixed;            Hin 336 544 fixed;            p1 400 464 fixed;            Hout 400 544 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.01489; 0.00213; 0.00213];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 20.0;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.024; 0.0; 0.096];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Hfloor0 272 544          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Sources\Constant.emx</LibraryPath> <TimeStamp>2007-10-19 14:48:44</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Constant           ports            signal out output [4,4];          end;          icon bg bottom           figures            rectangle 256.1 528 287.9 560 fill 15132390;            line 260.9 539.6 282.9 539.6 color 16711680 width 2;            line 258.2 550.7 283.9 550.7;            line 260.5 534.7 260.5 553;          end;          implementation eqequations	output = eye(4);     implementation_end;         Htip0 1248 544          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\SignalMonitor.emx</LibraryPath> <TimeStamp>2007-9-26 12:14:4</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type SignalMonitor           ports            signal in input [4,4];          end;          icon bg bottom           figures            rectangle 1232 528 1264 560 fill 15132390;            rectangle 1237.7 533.8 1258.3 554.6 color 16711680 fill 11776947 width 2;            rectangle 1239.8 536.4 1255.9 552 color -1 fill 16777215;            line 1241.9 538.7 1241.9 550 fill 16777215;            line 1240 548.4 1252.5 548.4 fill 16777215;            line 1241.5 548.1 1254.4 541.7 color 255 fill 16777215;          end;          implementation eq   implementation_end;         Joint12 608.2 504          description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <LibraryPath>Joint-roty_GravityCompensation.emx</LibraryPath>  <TimeStamp>2011-1-19 11:38:03</TimeStamp></Description>';          type 'Submodel-roty'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];           parameters            real InitialPos = -1.13;          end;          icon bg bottom           figures            rectangle 576.4 432 639.9 576 fill 14745599;            text 'Joint-roty   GC' 608.4 507 fill 14745599;           terminals            p 575.9 464 fixed;            p1 607.4 432 fixed;            p2 639.9 464 fixed;            Hin 575.9 544 fixed;            Hout 639.9 544 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = -1.13;             end;             icon bg              figures               rectangle 304 320 336 352 fill 15132390;               text 'ò' 320 333.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = int(input,init);R = [	cos(q),	0,	sin(q);			0,				1,	0;			-sin(q),	0,	cos(q)];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 496             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 480 335.9 512 fill 15132390;               text 'X' 320 496 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 56;            plug p2 496 424;            plug Hin 112 496;            plug Hout 504 496;            plug p 112 424;            OneJunction 240 272             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               power knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 272 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Tbai 240 384             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg left              figures               text '1' 240 384 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            uTbai 240 328             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'TF' 240 328 18 bold;             end;             implementation eqequations	p2.f = [0;p1.f;0;0;0;0];	p1.e = p2.e[2];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            p1 => ZeroJunction\p;            uTbai\p2 => Tbai\p;            Tbai\p => Wbai\p;            p <= Wbai\p;            ZeroJunction\p => OneJunction\p;            OneJunction\p => uTbai\p1;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            OneJunction\flow -> Integrate\input 320 272;            Splitter2\output -> AdHji\H 424 368;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 744 400;          implementation_end;         Joint23 768.2 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Joint-roty_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:38:03</TimeStamp></Description>';          type 'Submodel-roty'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];           parameters            real InitialPos = 2.5482;          end;          icon bg bottom           figures            rectangle 736.4 432 799.9 576 fill 14745599;            text 'Joint-roty   GC' 768.4 507 fill 14745599;           terminals            p 735.9 464 fixed;            p1 767.4 432 fixed;            p2 799.9 464 fixed;            Hin 735.9 544 fixed;            Hout 799.9 544 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = 2.5482;             end;             icon bg              figures               rectangle 304 320 336 352 fill 15132390;               text 'ò' 320 333.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = int(input,init);R = [	cos(q),	0,	sin(q);			0,				1,	0;			-sin(q),	0,	cos(q)];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 496             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 480 335.9 512 fill 15132390;               text 'X' 320 496 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 56;            plug p2 496 424;            plug Hin 112 496;            plug Hout 504 496;            plug p 112 424;            OneJunction 240 272             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               power knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 272 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Tbai 240 384             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg left              figures               text '1' 240 384 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            uTbai 240 328             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'TF' 240 328 18 bold;             end;             implementation eqequations	p2.f = [0;p1.f;0;0;0;0];	p1.e = p2.e[2];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            p1 => ZeroJunction\p;            uTbai\p2 => Tbai\p;            Tbai\p => Wbai\p;            p <= Wbai\p;            ZeroJunction\p => OneJunction\p;            OneJunction\p => uTbai\p1;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            OneJunction\flow -> Integrate\input 320 272;            Splitter2\output -> AdHji\H 424 368;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 744 400;          implementation_end;         Joint34 928.2 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Joint-roty_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:38:03</TimeStamp></Description>';          type 'Submodel-roty'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];           parameters            real InitialPos = -1.789;          end;          icon bg bottom           figures            rectangle 896.4 432 959.9 576 fill 14745599;            text 'Joint-roty   GC' 928.4 507 fill 14745599;           terminals            p 895.9 464 fixed;            p1 927.4 432 fixed;            p2 959.9 464 fixed;            Hin 895.9 544 fixed;            Hout 959.9 544 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = -1.789;             end;             icon bg              figures               rectangle 304 320 336 352 fill 15132390;               text 'ò' 320 333.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = int(input,init);R = [	cos(q),	0,	sin(q);			0,				1,	0;			-sin(q),	0,	cos(q)];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 496             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 480 335.9 512 fill 15132390;               text 'X' 320 496 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 56;            plug p2 496 424;            plug Hin 112 496;            plug Hout 504 496;            plug p 112 424;            OneJunction 240 272             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               power knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 272 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Tbai 240 384             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg left              figures               text '1' 240 384 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            uTbai 240 328             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'TF' 240 328 18 bold;             end;             implementation eqequations	p2.f = [0;p1.f;0;0;0;0];	p1.e = p2.e[2];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            p1 => ZeroJunction\p;            uTbai\p2 => Tbai\p;            Tbai\p => Wbai\p;            p <= Wbai\p;            ZeroJunction\p => OneJunction\p;            OneJunction\p => uTbai\p1;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;            OneJunction\flow -> Integrate\input 320 272;            Splitter2\output -> AdHji\H 424 368;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 744 400;          implementation_end;         Joint45 1088.2 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Joint-rotz_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:54</TimeStamp></Description>';          type 'Submodel-rotz'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];           parameters            real InitialPos = -2.9234;          end;          icon bg bottom           figures            rectangle 1056.4 432 1119.9 576 fill 14745599;            text 'Joint-rotz   GC' 1088.4 507 fill 14745599;           terminals            p 1055.9 464 fixed;            p1 1087.4 432 fixed;            p2 1119.9 464 fixed;            Hin 1055.9 544 fixed;            Hout 1119.9 544 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 288             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = -2.9234;             end;             icon bg              figures               rectangle 304 272 336 304 fill 15132390;               text 'ò' 320 285.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = int(input,init);R = [	cos(-q),	-sin(-q),	0;			sin(-q),	cos(-q),	0;			0,				0,				1];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 576             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 560 335.9 592 fill 15132390;               text 'X' 320 576 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 40;            plug p2 496 424;            plug Hin 112 576;            plug Hout 504 576;            plug p 112 424;            OneJunction 240 288             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               mechanical knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 288 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            uTbai 240 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;               causality fixed out p1;               causality fixed in p2;             end;             icon bg left              figures               text 'TF' 240 336 18 bold;             end;             implementation eqequations	p1.e = p2.e[3];	p2.f = [0;0;p1.f;0;0;0];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               mechanical knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            uTbai\p1 <= OneJunction\p;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            ZeroJunction\p => OneJunction\p;            p1 => ZeroJunction\p;            uTbai\p2 => Wbai\p;            p <= Wbai\p;            OneJunction\flow -> Integrate\input 288 288;            Splitter2\output -> AdHji\H 424 368;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 680 488;          implementation_end;         JointBase1 448.2 504          description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <LibraryPath>Joint-rotz_GravityCompensation.emx</LibraryPath>  <TimeStamp>2011-1-21 10:09:48</TimeStamp></Description>';          type 'Submodel-rotz'           ports            power out p [6,1];            power in p1;            power in p2 [6,1];            signal in Hin [4,4];            signal out Hout [4,4];           parameters            real InitialPos = -2.9496;          end;          icon bg bottom           figures            rectangle 416.4 432 479.9 576 fill 14745599;            text 'Joint-rotz   GC' 448.4 507 fill 14745599;           terminals            p 415.9 464 fixed;            p1 447.4 432 fixed;            p2 479.9 464 fixed;            Hin 415.9 544 fixed;            Hout 479.9 544 fixed;          end;          implementation bg           submodels            AdHji 424 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg bottom              figures               text 'MTF' 424 424 18 bold;             end;             implementation eqequations						p2.e = transpose(Adjoint(H)) * p1.e;	p1.f = Adjoint(H) * p2.f;implementation_end;            Integrate 320 288             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Integrate.emx</LibraryPath> <TimeStamp>2007-9-26 12:3:23</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Integrate              ports               signal in input;               signal out output [4,4];              parameters               real init = -2.9496;             end;             icon bg              figures               rectangle 304 272 336 304 fill 15132390;               text 'ò' 320 285.3 color 16711680 'SymbolProp BT' 21 symbol;             end;             implementation eqvariables	real R[3,3];	real p[3];	real q;equationsq = int(input,init);R = [	cos(-q),	-sin(-q),	0;			sin(-q),	cos(-q),	0;			0,				0,				1];p = [0;0;0];output = homogeneous(R,p);	     implementation_end;            MatrixMul 320 576             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Signal\Block Diagram\Gain.emx</LibraryPath> <TimeStamp>2007-9-26 12:15:12</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input1 [4,4];               signal out output [4,4];               signal in input2 [4,4];             end;             icon bg bottom              figures               rectangle 304.1 560 335.9 592 fill 15132390;               text 'X' 320 576 color 16711680 16 bold;             end;             implementation eqequations	output = input2*input1;    implementation_end;            plug p1 240 40;            plug p2 496 424;            plug Hin 112 576;            plug Hout 504 576;            plug p 112 424;            OneJunction 240 288             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';             knot OneJunction              ports               mechanical knot duplicatable none p [1];               signal knot out flow [1];              restrictions               causality constraint one_out p;             end;             icon bg              figures               text '1' 240 288 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Splitter2 320 368             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 316.8 364.8 323.2 371.2 color -1 fill 0;               ellipse 315.7 363.7 324.3 372.3 color -1;              terminals               input 320 368 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            uTbai 240 336             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power in p1;               power out p2 [6,1];              restrictions               causality constraint not_equal p1 p2;               causality fixed out p1;               causality fixed in p2;             end;             icon bg left              figures               text 'TF' 240 336 18 bold;             end;             implementation eqequations	p1.e = p2.e[3];	p2.f = [0;0;p1.f;0;0;0];implementation_end;            Wbai 240 424             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:43</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot ZeroJunction              ports               power knot duplicatable none p [6,1];               signal knot out effort [6,1];              restrictions               causality constraint one_in p;             end;             icon bg bottom              figures               text '0' 240 424 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;            ZeroJunction 240 104             description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';             knot ZeroJunction              ports               mechanical knot duplicatable none p [1];               signal knot out effort [1];              restrictions               causality constraint one_in p;             end;             icon bg              figures               text '0' 240 104 18 bold;             end;             implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;           end;           connections            uTbai\p1 <= OneJunction\p;            Wbai\p <= AdHji\p1;            p2 => AdHji\p2;            ZeroJunction\p => OneJunction\p;            p1 => ZeroJunction\p;            uTbai\p2 => Wbai\p;            p <= Wbai\p;            OneJunction\flow -> Integrate\input 288 288;            Splitter2\output -> AdHji\H 424 368;            MatrixMul\output -> Hout;            Hin -> MatrixMul\input2;            Integrate\output -> Splitter2\input;            Splitter2\output -> MatrixMul\input1;           end;           parameterrelationsIntegrate\init = InitialPos;parameterrelations_end;           figures            text 'b = next link (body)a = previous link (body)i = Frame fixed in previous body, fixed in jointj = Frame fixed in next body, fixed in joint ' 680 488;          implementation_end;         Link1 528 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 2.412;            real COMdim[3,1] = [0.10453; 0.0017; -0.00297];            real dim[3,1] = [0.033; 0.0; 0.019];          end;          icon bg bottom           figures            rectangle 496 432 560 576 fill 10025880;            text 'LinkGC' 528 504;           terminals            p 496 464 fixed;            Hin 496 544 fixed;            p1 560 464 fixed;            Hout 560 544 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.10453; 0.0017; -0.00297];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 2.412;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.033; 0.0; 0.019];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link2 688 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 1.155;            real COMdim[3,1] = [0.001; 0.0967; 0.02107];            real dim[3,1] = [0.0; 0.0; 0.155];          end;          icon bg bottom           figures            rectangle 656 432 720 576 fill 10025880;            text 'LinkGC' 688 504;           terminals            p 656 464 fixed;            Hin 656 544 fixed;            p1 720 464 fixed;            Hout 720 544 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.001; 0.0967; 0.02107];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 1.155;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.155];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link3 848 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 0.934;            real COMdim[3,1] = [0.011; 0.05103; -0.02319];            real dim[3,1] = [0.0; 0.0; 0.135];          end;          icon bg bottom           figures            rectangle 816 432 880 576 fill 10025880;            text 'LinkGC' 848 504;           terminals            p 816 464 fixed;            Hin 816 544 fixed;            p1 880 464 fixed;            Hout 880 544 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.011; 0.05103; -0.02319];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 0.934;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.135];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link4 1008 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 0.877;            real COMdim[3,1] = [0.0; 0.00115; -0.01683];            real dim[3,1] = [0.0; 0.0; 0.096];          end;          icon bg bottom           figures            rectangle 976 432 1040 576 fill 10025880;            text 'LinkGC' 1008 504;           terminals            p 976 464 fixed;            Hin 976 544 fixed;            p1 1040 464 fixed;            Hout 1040 544 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.0; 0.00115; -0.01683];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 0.877;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.096];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Link5 1168 504          description '<Description> <Version>4.1</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate> <LibraryPath>Link_GravityCompensation.emx</LibraryPath> <TimeStamp>2011-1-19 11:37:47</TimeStamp>   <Description>Base</Description></Description>';          type Submodel           ports            power out p [6,1];            signal in Hin [4,4];            power in p1 [6,1];            signal out Hout [4,4];           parameters            real m = 1.121;            real COMdim[3,1] = [0.0; 0.0; 0.001];            real dim[3,1] = [0.0; 0.0; 0.034];          end;          icon bg bottom           figures            rectangle 1136 432 1200 576 fill 10025880;            text 'LinkGC' 1168 504;           terminals            p 1136 464 fixed;            Hin 1136 544 fixed;            p1 1200 464 fixed;            Hout 1200 544 fixed;          end;          implementation bg           submodels            AdHi0 664 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power in p1 [6,1];               power out p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg left              figures               text 'MTF' 664 416 18 bold;             end;             implementation eqvariables 	real onlyRotH[4,4];code	//Only rotations with respect to the inertial system matter!	onlyRotH = H;	onlyRotH[1,4] = 0;	onlyRotH[2,4] = 0;	onlyRotH[3,4] = 0;							p2.e = transpose(Adjoint(onlyRotH)) * p1.e;	p1.f = Adjoint(onlyRotH) * p2.f;implementation_end;            AdHij 816 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\MTF.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:3</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type MTF              ports               power out p1 [6,1];               power in p2 [6,1];               signal in H [4,4];              restrictions               causality constraint not_equal p1 p2;             end;             icon bg top              figures               text 'MTF' 816 304 18 bold;             end;             implementation eqequations	//Only rotations with respect to the inertial system matter!							p1.e = transpose(Adjoint(H)) * p2.e;	p2.f = Adjoint(H) * p1.f;implementation_end;            AdHik1 664 368             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\TF.emx</LibraryPath> <TimeStamp>2007-9-25 12:4:2</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type TF              ports               power out p1 [6,1];               power in p2 [6,1];              restrictions               causality constraint not_equal p1 p2;              parameters               real COMdim[3,1] = [0.0; 0.0; 0.001];             end;             icon bg left              figures               text 'TF' 664 368 18 bold;             end;             implementation eq//Principal inertial frame connected in port 2variables	real d[3]; //distance between frames	real R[3,3]; //rotation between frames	real H[4,4]; //homogeneous matrix	real AdH[6,6]; //Adjoint of homogeneous matrixequations	d = COMdim; //distance of 1 in z direction of frames	R = eye(3); //no rotation	H = homogeneous(R,d);	AdH = Adjoint(H);	p1.f = AdH * p2.f; 	p2.e = transpose(AdH) * p1.e;implementation_end;            Gravity 776 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Se              ports               power out p [6,1];              restrictions               causality fixed out p;              parameters               real m = 1.121;             end;             icon bg bottom              figures               text 'Se' 776 416 18 bold;             end;             implementation eqvariables	real effort[6];equations	effort = [0;0;0;0;0;9.8*m];	p.e = effort;implementation_end;            Hij 816 496             description '<Description>   <Version>4.1</Version><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues>   <LibraryPath>H.emx</LibraryPath>  <TimeStamp>2010-9-21 15:03:50</TimeStamp><AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             type Gain              ports               signal in input [4,4];               signal out output [4,4];               signal out Hab [4,4];              parameters               real dim[3,1] = [0.0; 0.0; 0.034];             end;             icon bg bottom              figures               rectangle 800.1 480 831.9 512 fill 15132390;               text 'H' 816 496 color 16711680 16 bold;             end;             implementation eqequations	Hab = homogeneous(eye(3),dim);	output = input * Hab;    implementation_end;            plug Hin 592 496;            plug p1 904 304;            plug Hout 896 496;            plug p 592 304;            Splitter1 664 496             description '<Description><Version>4.0</Version>   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>  <TimeStamp>2008-01-17 11:28:29</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';             knot Splitter              ports               signal knot duplicatable out output [4,4];               signal knot in input [4,4];             end;             icon bg ellipse              figures               ellipse 660.8 492.8 667.2 499.2 color -1 fill 0;               ellipse 659.7 491.7 668.3 500.3 color -1;              terminals               input 664 496 fixed;             end;             implementation eqequations    collect (output) = input;implementation_end;            Ta00 720 416             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 720 416 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;            Ta0i 664 304             description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath> <TimeStamp>2007-9-27 9:51:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate>   <Description></Description></Description>';             knot OneJunction              ports               power knot duplicatable none p [6,1];               signal knot out flow [6,1];              restrictions               causality constraint one_out p;             end;             icon bg bottom              figures               text '1' 664 304 18 bold;             end;             implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;           end;           connections            Ta0i\p <= AdHik1\p1;            AdHi0\p2 => AdHik1\p2;            Gravity\p => Ta00\p;            p <= Ta0i\p;            Ta0i\p <= AdHij\p1;            p1 => AdHij\p2;            Ta00\p => AdHi0\p1;            Hin -> Splitter1\input;            Hij\output -> Hout;            Splitter1\output -> Hij\input;            Splitter1\output -> AdHi0\H;            Hij\Hab -> AdHij\H;           end;           parameterrelationsAdHik1\COMdim = COMdim;Hij\dim = dim;Gravity\m=m;parameterrelations_end;           figures            text 'b = current link (body)a = previous link (body)i = Body fixed frame, fixed in joint with previous linkj = Body fixed frame, fixed in joint with next linkk = Body fixed frame, principal inertial frame0 = inertial system ' 416 376;          implementation_end;         Mux 696 193          description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Submodel           ports            power out port [9,1];            power out port5;            power out port6;            power out port7;            power out port8;            power out port9;           restrictions            causality fixed in port8;            causality fixed in port9;            causality fixed in port6;            causality fixed in port7;            causality fixed out port;            causality fixed in port5;          end;          icon bg           figures            rectangle 616 178 776 208 fill 14013909;            text 'Mux' 696 192 16;           terminals            port 696 176 fixed;            port5 696 208 fixed;            port6 712 208 fixed;            port7 728 208 fixed;            port8 744 208 fixed;            port9 760 208 fixed;          end;          implementation eqequations	port.e[1] = 0;	port.e[2] = 0;	port.e[3] = 0;	port.e[4] = 0;	port.e[5] = port5.e;	port.e[6] = port6.e;	port.e[7] = port7.e;	port.e[8] = port8.e;	port.e[9] = port9.e;		port5.f = port.f[5];	port6.f = port.f[6];	port7.f = port.f[7];	port8.f = port.f[8];	port9.f = port.f[9];implementation_end;         plug joints 696 120;         Wtip0 1240 464          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\Se.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:26</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type Se           ports            power out p [6,1];           restrictions            causality fixed out p;          end;          icon bg bottom           figures            text 'Se' 1240 464 18 bold;          end;          implementation eqparameters	real effort = 0;variables	real flow[6];equations	p.e = effort;	flow = p.f;implementation_end;         ZeroJunction 272 464          description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\ZeroJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:43</TimeStamp></Description>';          knot ZeroJunction           ports            power knot duplicatable none p [6,1];            signal knot out effort [6,1];           restrictions            causality constraint one_in p;          end;          icon bg           figures            text '0' 272 464 18 bold;          end;          implementation eqequations	sum (direct (p.f)) = 0;	equal (collect (p.e));	effort = first (p.e);implementation_end;        end;        connections         Base\p => ZeroJunction\p;         Joint34\p => Link3\p1;         Link4\p => Joint34\p2;         Joint45\p => Link4\p1;         joints <= Mux\port;         Link5\p => Joint45\p2;         JointBase1\p1 <= Mux\port5 448 304 696 304;         Joint12\p1 <= Mux\port6 608 320 712 320;         JointBase1\p => Base\p1;         Wtip0\p => Link5\p1;         Mux\port7 => Joint23\p1 728 256 768 256;         Mux\port8 => Joint34\p1 744 240 928 240;         Mux\port9 => Joint45\p1 760 224 1088 224;         JointBase1\p2 <= Link1\p;         Joint12\p => Link1\p1;         Joint12\p2 <= Link2\p;         Joint23\p => Link2\p1;         Joint23\p2 <= Link3\p;         Hfloor0\output -> Base\Hin;         Htip0\input <- Link5\Hout;         Link1\Hin <- JointBase1\Hout;         Joint45\Hout -> Link5\Hin;         Joint45\Hin <- Link4\Hout;         Joint34\Hout -> Link4\Hin;         Joint34\Hin <- Link3\Hout;         Link3\Hin <- Joint23\Hout;         Link2\Hout -> Joint23\Hin;         Link2\Hin <- Joint12\Hout;         Joint12\Hin <- Link1\Hout;         Base\Hout -> JointBase1\Hin;        end;        parameterrelationsBase\m = Linkm[1];Base\COMdim = LinkCOMdim[1:3,1];Base\dim = Linkdim[1:3,1];Link1\m = Linkm[2];Link1\COMdim = LinkCOMdim[1:3,2];Link1\dim = Linkdim[1:3,2];Link2\m = Linkm[3];Link2\COMdim = LinkCOMdim[1:3,3];Link2\dim = Linkdim[1:3,3];Link3\m = Linkm[4];Link3\COMdim = LinkCOMdim[1:3,4];Link3\dim = Linkdim[1:3,4];Link4\m = Linkm[5];Link4\COMdim = LinkCOMdim[1:3,5];Link4\dim = Linkdim[1:3,5];Link5\m = Linkm[6];Link5\COMdim = LinkCOMdim[1:3,6];Link5\dim = Linkdim[1:3,6];JointBase1\InitialPos = InitialJointPos[1];Joint12\InitialPos = InitialJointPos[2];Joint23\InitialPos = InitialJointPos[3];Joint34\InitialPos = InitialJointPos[4];Joint45\InitialPos = InitialJointPos[5];parameterrelations_end;       implementation_end;      I 720 232       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\3D\I-3.emx</LibraryPath> <TimeStamp>2007-9-25 12:12:14</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type 'I-3'        ports         power in p [9,1];         signal out state [9,1];        restrictions         causality preferred in p;       end;       icon bg bottom        figures         text 'I' 720 232 18 bold;       end;       implementation eqparameters	real i[9] = [1.0, 1.0, 1.0; 1.0, 1.0, 1.0; 1.0, 1.0, 1.0];	real init_pose[8]=[0.0;0.0;0.0;-2.9496; -1.13; 2.5482; -1.789; -2.9234];	real r = 0.047;	real x = 0.235;	real y = 0.15;	real baseoffset[3]=[0.143;  0;  0.046]; //coordinates of joint_1 	real Linkdim[3,6]=[0.024, 0.033, 0.0, 0.0, 0.0, 0.0;						 	0.0, 		0.0, 	0.0, 0.0, 0.0, 0.0;						 	0.096, 0.019, 0.155, 0.135, 0.096, 0.034];	real LinkCOMdim[3,6]=[0.01489, 0.10453, 0.001, 0.011, 0.0, 0.0;			 					0.00213, 0.0017, 0.0967, 0.05103, 0.00115, 0.0;				 				0.00213, -0.00297, 0.02107, -0.02319, -0.01683, 0.001];	real Linkm[6]=[20.0; 2.412; 1.155; 0.934; 0.877; 1.121];	real LinkI[3,6]=[20.0, 1.0, 1.0, 1.0, 1.0, 1.0;						  20.0, 1.0, 1.0, 1.0, 1.0, 1.0;						  20.0, 1.0, 1.0, 1.0, 1.0, 1.0];constants		real hidden vx[3] = [1;0;0];	real hidden vy[3] = [0;1;0];	real hidden omegaz[3] = [0;0;1];	real hidden omega1[3] = [0;0;-1]; 	real hidden omega2[3] = [0;1;0]; 	real hidden omega3[3] = [0;1;0]; 	real hidden omega4[3] = [0;1;0]; 	real hidden omega5[3] = [0;0;-1];variables	real uTrzrefref[6];	real uTryrefref[6];	real uTrxrefref[6];	real uTr1refref[6];	real uTr211[6];		real uTr322[6];		real uTr433[6];	real uTr544[6];	real velocity[8];	real A[3,4];	real PseudoInverseA[4,3];	real 					R1ref[3,3], 	R21[3,3], 	R32[3,3], 	R43[3,3], 	R54[3,3], 	Rtip5[3,3];	real 					p1ref[3], 		p21[3], 		p32[3], 		p43[3], 		p54[3], 		ptip5[3];	real 	Href0[4,4],	H1ref[4,4], 	H21[4,4], 	H32[4,4], 	H43[4,4], 	H54[4,4], 	Htip5[4,4];	real 					H10[4,4],		H20[4,4],	H30[4,4],	H40[4,4],	H50[4,4];	real Htip0[4,4];	real Hc0[4,4],Hc1[4,4],Hc2[4,4],Hc3[4,4],Hc4[4,4],Hc5[4,4];	real Hc00[4,4],Hc10[4,4],Hc20[4,4],Hc30[4,4],Hc40[4,4],Hc50[4,4];	real base_offset_H[4,4];	real q[8];	real Rz[3,3];	real Jc[6,8],Jc0[6,8],Jc1[6,8],Jc2[6,8],Jc3[6,8],Jc4[6,8],Jc5[6,8];	real I0[6,6],I1[6,6],I2[6,6],I3[6,6],I4[6,6],I5[6,6];	real M[8,8],Mb[9,9];	real Jb[8,9];	real n_f;initialequations	 Jb=1;equations	state = int(p.e);	p.f = inverse(diag(i)) * state;		A =  (1/(2*r))*	[ 	x+y 	,x+y	,x+y	,x+y;		-1		, 1	,-1	, 1;		1		, 1	,-1	,- 1];		PseudoInverseA = transpose(A)*inverse(A*transpose(A));	velocity[1:3] = transpose(PseudoInverseA)*p.f[1:4];	velocity[4:8] =p.f[5:9];	q=int(velocity,init_pose);	base_offset_H=homogeneous(eye(3),baseoffset);		Rz=[cos(q[1]), -sin(q[1]), 0; 		sin(q[1]), cos(q[1]), 	0;		 0, 					0, 					1];	Href0 =homogeneous(Rz,[q[2];q[3];0])*base_offset_H;	//Calculate relative positions of the joints	R1ref = [	cos(-q[4]),	-sin(-q[4]),	0;				sin(-q[4]),	cos(-q[4]),	0;				0,				0,				1];	p1ref = Linkdim[1:3,1];	H1ref = homogeneous(R1ref,p1ref);	R21 = [	cos(q[5]),	0,	sin(q[5]);				0,				1,	0;				-sin(q[5]),	0,	cos(q[5])];	p21 = Linkdim[1:3,2];	H21 = homogeneous(R21,p21);	R32 = [	cos(q[6]),	0,	sin(q[6]);				0,				1,	0;				-sin(q[6]),	0,	cos(q[6])];	p32 = Linkdim[1:3,3];	H32 = homogeneous(R32,p32);		R43 = [	cos(q[7]),	0,	sin(q[7]);				0,				1,	0;				-sin(q[7]),	0,	cos(q[7])];	p43 = Linkdim[1:3,4];	H43 = homogeneous(R43,p43);	R54 = [	cos(-q[8]),	-sin(-q[8]),	0;				sin(-q[8]),	cos(-q[8]),	0;				0,				0,				1];	p54 = Linkdim[1:3,5];	H54 = homogeneous(R54,p54);	Rtip5 = eye(3);	ptip5 = Linkdim[1:3,6];	Htip5 = homogeneous(Rtip5,ptip5);	//calculate position of the joints with respect to inertial frame	uTrzrefref[1:3] = omegaz; 	uTrzrefref[4:6] = 0;	uTryrefref[1:3] = 0;	uTryrefref[4:6] = vy;	uTrxrefref[1:3] = 0;	uTrxrefref[4:6] = vx;	uTr1refref[1:3] = omega1;	uTr1refref[4:6] = skew(Linkdim[1:3,1])*omega1;	uTr211[1:3] = omega2;	uTr211[4:6] = skew(Linkdim[1:3,2])*omega2;	uTr322[1:3] = omega3;	uTr322[4:6] = skew(Linkdim[1:3,3])*omega3;	uTr433[1:3] = omega4;	uTr433[4:6] = skew(Linkdim[1:3,4])*omega4;	uTr544[1:3] = omega5;	uTr544[4:6] = skew(Linkdim[1:3,5])*omega5;		H10 = Href0 * H1ref;	H20 = H10 * H21;	H30 = H20 * H32;	H40 = H30 * H43;	H50 = H40 * H54;	Htip0 = H50 * Htip5;	Hc0=homogeneous(eye(3),LinkCOMdim[1:3,1]);	Hc1=homogeneous(eye(3),LinkCOMdim[1:3,2]);	Hc2=homogeneous(eye(3),LinkCOMdim[1:3,3]);	Hc3=homogeneous(eye(3),LinkCOMdim[1:3,4]);	Hc4=homogeneous(eye(3),LinkCOMdim[1:3,5]);	Hc5=homogeneous(eye(3),LinkCOMdim[1:3,6]);	Hc00=Href0*Hc0;	Hc10=H10*Hc1;	Hc20=H20*Hc2;	Hc30=H30*Hc3;	Hc40=H40*Hc4;	Hc50=H50*Hc5;	Jc[1:6,1] = Adjoint(Href0)*uTrzrefref;	Jc[1:6,3] = Adjoint(Href0)*uTryrefref;	Jc[1:6,2] = Adjoint(Href0)*uTrxrefref;	Jc[1:6,4] = Adjoint(Href0)*uTr1refref;	Jc[1:6,5] = Adjoint(H10)*uTr211;	Jc[1:6,6] = Adjoint(H20)*uTr322;	Jc[1:6,7] = Adjoint(H30)*uTr433;	Jc[1:6,8] = Adjoint(H40)*uTr544;	Jc0=Adjoint(inverseH(Hc0))*transpose(diag([1;1;1;0;0;0;0;0])*transpose(Jc));	Jc1=Adjoint(inverseH(Hc1))*transpose(diag([1;1;1;1;0;0;0;0])*transpose(Jc));	Jc2=Adjoint(inverseH(Hc2))*transpose(diag([1;1;1;1;1;0;0;0])*transpose(Jc));	Jc3=Adjoint(inverseH(Hc3))*transpose(diag([1;1;1;1;1;1;0;0])*transpose(Jc));	Jc4=Adjoint(inverseH(Hc4))*transpose(diag([1;1;1;1;1;1;1;0])*transpose(Jc));	Jc5=Adjoint(inverseH(Hc5))*transpose(diag([1;1;1;1;1;1;1;1])*transpose(Jc));	I0=diag([Linkm[1];Linkm[1];Linkm[1];LinkI[1,1];LinkI[2,1];LinkI[3,1]]);	I1=diag([Linkm[2];Linkm[2];Linkm[2];LinkI[1,2];LinkI[2,2];LinkI[3,2]]);	I2=diag([Linkm[3];Linkm[3];Linkm[3];LinkI[1,3];LinkI[2,3];LinkI[3,3]]);	I3=diag([Linkm[4];Linkm[4];Linkm[4];LinkI[1,4];LinkI[2,4];LinkI[3,4]]);	I4=diag([Linkm[5];Linkm[5];Linkm[5];LinkI[1,5];LinkI[2,5];LinkI[3,5]]);	I5=diag([Linkm[6];Linkm[6];Linkm[6];LinkI[1,6];LinkI[2,6];LinkI[3,6]]);	M=transpose(Jc0)*I0*Jc0+transpose(Jc1)*I1*Jc1+transpose(Jc2)*I2*Jc2+	  transpose(Jc3)*I3*Jc3+transpose(Jc4)*I4*Jc4+transpose(Jc5)*I5*Jc5;	Jb[1:3,1:4]=transpose(PseudoInverseA);	Jb[4:8,1:4]=0;	Jb[1:3,5:9]=0;	Jb[4:8,5:9]=eye(5);	Mb=transpose(Jb)*M*Jb;	n_f=norm((Mb));//controllableJ[1:6,8] = Adjoint(H40)*uTr544;/*controllableJ[1:6,1] = Adjoint(Href0)*uTrzrefref;controllableJ[1:6,3] = Adjoint(Href0)*uTryrefref;controllableJ[1:6,2] = Adjoint(Href0)*uTrxrefref;controllableJ[1:6,4] = Adjoint(Href0)*uTr1refref;controllableJ[1:6,5] = Adjoint(H10)*uTr211;controllableJ[1:6,6] = Adjoint(H20)*uTr322;controllableJ[1:6,7] = Adjoint(H30)*uTr433;controllableJ[1:6,8] = Adjoint(H40)*uTr544;*/implementation_end;      JointSoftLimits1 560 304       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\C.emx</LibraryPath> <TimeStamp>2007-10-31 10:43:59</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type C        ports         power in p [9,1];        restrictions         causality preferred out p;       end;       icon bg bottom        figures         text 'C' 560 304 color 128 18 bold;       end;       implementation eqparameters 	real c[9]= [0.0;0.0;0.0;0.0;200.0;200.0;200.0;200.0;200.0];	real limits_low[9]= [ -10;-10;-10;-10;-2.9496 ; -1.13 ; -2.4733;  -1.789 ; -2.9234];  	real limits_high[9]= [ 10;10;10;10; 2.8847   ;1.4809  ; 2.5482  ; 1.6368 ;  2.7125];	real working_range= 1;	real init_pose[9]= [0.0;0.0;0.0;0.0;-2.949;-1.13;2.5482;-1.789;-2.923];	real joint_direction_map[9]=[1; 1; 1; 1; 1; 1; 1;1;1];variables	real substate[9];	real angle_limits_low[9];	real angle_limits_high[9];	real state[9];initialequations	state=init_pose;code  state=diag(joint_direction_map)*int(p.f,init_pose);  angle_limits_low=working_range*limits_low;  angle_limits_high=working_range*limits_high;  substate[1]=(limit(state[1]-angle_limits_high[1],0,10))+(limit(state[1]-angle_limits_low[1],-10,0));  substate[2]=(limit(state[2]-angle_limits_high[2],0,10))+(limit(state[2]-angle_limits_low[2],-10,0));  substate[3]=(limit(state[3]-angle_limits_high[3],0,10))+(limit(state[3]-angle_limits_low[3],-10,0));  substate[4]=(limit(state[4]-angle_limits_high[4],0,10))+(limit(state[4]-angle_limits_low[4],-10,0));  substate[5]=(limit(state[5]-angle_limits_high[5],0,10))+(limit(state[5]-angle_limits_low[5],-10,0));  substate[6]=(limit(state[6]-angle_limits_high[6],0,10))+(limit(state[6]-angle_limits_low[6],-10,0));  substate[7]=(limit(state[7]-angle_limits_high[7],0,10))+(limit(state[7]-angle_limits_low[7],-10,0));  substate[8]=(limit(state[8]-angle_limits_high[8],0,10))+(limit(state[8]-angle_limits_low[8],-10,0));  substate[9]=(limit(state[9]-angle_limits_high[9],0,10))+(limit(state[9]-angle_limits_low[9],-10,0));  p.e = diag(c)*substate;implementation_end;      plug Arm1_joint_cmd 288 264;      plug Arm1_joint_states 288 200;      plug Base_odometry_state 288 184;      plug Arm1_joint_velocities 288 232;      plug Base_joint_velocities 288 216;      plug Base_joint_states 288 248;      plug Base_joint_cmd 304 296;      plug Base_twist_cmd 288 280;      OneJunction1 608 232       description '<Description><Version>4.0</Version><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues>   <LibraryPath>Bond Graph\OneJunction.emx</LibraryPath>  <TimeStamp>2007-9-27 9:51:18</TimeStamp></Description>';       knot OneJunction        ports         power knot duplicatable none p [9,1];         signal knot out flow [9,1];        restrictions         causality constraint one_out p;       end;       icon bg        figures         text '1' 608 232 18 bold;       end;       implementation eqequations	sum (direct (p.e)) = 0;	equal (collect (p.f));	flow = first (p.f);implementation_end;      R 600 344       description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type R        ports         power in p [9,1];       end;       icon bg bottom        figures         text 'R' 600 344 18 bold;       end;       implementation eqparameters	real r = 5.0;equations						p.e = eye(9)*r * p.f;implementation_end;      stiction_M 664 304       description '<Description> <Version>4.0</Version> <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath> <TimeStamp>2007-10-31 11:32:54</TimeStamp> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';       type Submodel        ports         power in port1 [9,1];        restrictions         causality fixed out port1;       end;       icon bg bottom        figures         text 'R' 664 304 color 128 24 bold;       end;       implementation bg        submodels         plug port1 280 64;         R1 192 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;           restrictions            causality fixed out p;          end;          icon bg bottom           figures            text 'R' 192 232 18 bold;          end;          implementation eqparameters	real a =  0.05615;	real b = -8.68;	real c =  0.04245;	real d =  0.2383;	real a2 =  0.07022;	real b2 = -0.1932;	real c2 =  7.554e-10;	real d2 =  6.858;	real p11 = 0.07582;	real p12 = -0.1201;	real a3 =  3.243e9;	real b3 = -7.739;	real c3 =  0.07271;	real d3 =  0.09647;	real p21 = 0.0125;	real p22 = 0.05584;	real r_extra = 0.01;	real r_offset = 0.0;variables	real abs_vel;	real r1,r2,r3,r4,r5,r6,r7,r8;	real n;	real rfriction_FL;code	abs_vel = abs(p.f);    	r1 = 5*abs_vel + 1e-6;	r2 = a*exp(b*abs_vel) + c*exp(d*abs_vel);	r3 = a2*exp(b2*abs_vel) + c2*exp(d2*abs_vel);	r4 = p11*abs_vel + p12;	r5 = a3*exp(b3*abs_vel) + c3*exp(d3*abs_vel);	r6 = p21*abs_vel + p22;    	r7 = 0.06 + 0.4*abs_vel;	r8 = 0.071 + 0.01*abs_vel;        	if abs_vel < 0.7 then		n = 25;		rfriction_FL = 1/(1/r1^n + 1/r2^n + 1/r7^n + 1/r8^n)^(1/n);	end;		if abs_vel >= 0.7 and abs_vel < 1.5 then		n = 30;		rfriction_FL = 1/(1/r2^n + 1/r3^n)^(1/n);	end;        	if abs_vel >= 1.5 and abs_vel < 2.5 then		rfriction_FL = r3;	end;    	if abs_vel >= 2.5 and abs_vel < 3.2 then		n = 30;		rfriction_FL = 1/(1/r3^n + 1/r4^n)^(1/n);	end;        	if abs_vel >= 3.2 and abs_vel < 3.5 then		n = 20;		rfriction_FL = 1/(1/r4^n + 1/r5^n)^(1/n);	end;        	if abs_vel >= 3.5 and abs_vel < 4.59 then		rfriction_FL = r5;	end;        	if abs_vel >= 4.59 then		rfriction_FL = r6;	end;        rfriction_FL = (rfriction_FL + r_extra)*sign(p.f) + r_offset;	p.e=rfriction_FL;implementation_end;         R2 232 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;          end;          icon bg bottom           figures            text 'R' 232 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         R3 248 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;          end;          icon bg bottom           figures            text 'R' 248 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         R4 264 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;          end;          icon bg bottom           figures            text 'R' 264 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         R5 280 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;          end;          icon bg bottom           figures            text 'R' 280 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         R6 296 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;          end;          icon bg bottom           figures            text 'R' 296 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         R7 312 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;          end;          icon bg bottom           figures            text 'R' 312 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         R8 328 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;          end;          icon bg bottom           figures            text 'R' 328 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         R9 344 232          description '<Description> <Version>4.0</Version> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <LibraryPath>Bond Graph\R.emx</LibraryPath> <TimeStamp>2007-9-25 12:3:18</TimeStamp> <AllowLibraryUpdate>True</AllowLibraryUpdate></Description>';          type R           ports            power in p;           restrictions            causality fixed out p;          end;          icon bg bottom           figures            text 'R' 344 232 18 bold;          end;          implementation eqparameters	real r = 0.0;equations						p.e = r * p.f;implementation_end;         Submodel1 280 128          description '<Description> <Version>4.0</Version>   <LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath>  <TimeStamp>2007-10-31 11:32:54</TimeStamp><IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues></Description>';          type Submodel           ports            power in input [9,1];            power out port1;            power out port2;            power out port3;            power out port4;            power out port5;            power out port6;            power out port7;            power out port8;            power out port9;           restrictions            causality fixed in port2;            causality fixed out input;            causality fixed in port1;            causality fixed in port9;            causality fixed in port8;            causality fixed in port7;            causality fixed in port6;            causality fixed in port5;            causality fixed in port4;            causality fixed in port3;          end;          implementation eqequations	input.e[1]=port1.e;	input.e[2]=port2.e;	input.e[3]=port3.e;	input.e[4]=port4.e;	input.e[5]=port5.e;	input.e[6]=port6.e;	input.e[7]=port7.e;	input.e[8]=port8.e;	input.e[9]=port9.e;	port1.f=input.f[1];	port2.f=input.f[2];	port3.f=input.f[3];	port4.f=input.f[4];	port5.f=input.f[5];	port6.f=input.f[6];	port7.f=input.f[7];	port8.f=input.f[8];	port9.f=input.f[9];implementation_end;        end;        connections         Submodel1\port1 => R1\p;         R6\p <= Submodel1\port6;         R7\p <= Submodel1\port7;         Submodel1\port8 => R8\p;         Submodel1\port9 => R9\p;         Submodel1\input <= port1;         Submodel1\port2 => R2\p;         R3\p <= Submodel1\port3;         R4\p <= Submodel1\port4;         R5\p <= Submodel1\port5;        end;       implementation_end;      YouBot_OODL 440 240       description '<Description> <Version>4.0</Version> <LibraryPath>Template\Submodel-Equation.emx</LibraryPath> <IsMainModel>1</IsMainModel> <KeepParameterValues>False</KeepParameterValues> <TimeStamp>2007-11-1 22:32:1</TimeStamp> <AllowLibraryUpdate>False</AllowLibraryUpdate></Description>';       type 'Submodel-Equation'        ports         signal in Base_twist_cmd [3,1];         power out HW_bond [9,1];         signal in Arm1_joint_cmd [5,1];         signal out Arm1_joint_states [5,1];         signal out Base_odometry_state [3,1];         signal out Arm1_joint_velocities [5,1];         signal out Base_joint_velocities [4,1];         signal out Base_joint_states [4,1];         signal in Base_joint_cmd [4,1];        restrictions         causality fixed out HW_bond;       end;       icon bg        figures         rectangle 392 176 488 304 fill 14013909;         text 'name' 440 248 16;         text 'STUB' 440 200 'Bank Gothic' 20 bold;        terminals         Base_twist_cmd 392 280 fixed;         HW_bond 488 232 fixed;         Arm1_joint_cmd 392 264 fixed;         Arm1_joint_states 392 200 fixed;         Base_odometry_state 392 184 fixed;         Arm1_joint_velocities 392 232 fixed;         Base_joint_velocities 392 216 fixed;         Base_joint_states 392 248 fixed;         Base_joint_cmd 392 296 fixed;       end;       implementation eqparameters	real joint_initial_states[5]=[0;0;0;0;0];	real 	Wheelpos[2]= [0.235;0.15];	real  MecanumWheelRadius= 0.047;	real Current_limits[5]=[2.44,2.44,2.40,0.73,0.42];   real gear_ratio[5] =  [156;  156  ;  100 ;  71 ; 71];	real torque_const[5]=[0.0335;0.0335;0.0335;0.051;0.49];	real base_gear_ratio=0.03870;	real base_torue_const=0.0335;	real base_current_limit=2.44;	real base_PI_P= 60.0;	real base_PI_I= 53.0;	boolean use_twist= false;variables	real A[3,4];	real PseudoInverseA[4,3];	real RotMechanumWheel; 	real virtualJoints_f[3];	real Base_Twist[6];	real Base_dotT[4,4],Base_H[4,4];	real Base_init[4,4];	real pitch,yaw;	real force_limits[5]; 	real base_force_limit;	real wheel_veloicties[4];	real Base_joint_cmd_temp[4];	real base_twist_delta[3];initialequations	Base_init=eye(4);	force_limits=diag(gear_ratio .* torque_const)*Current_limits;	base_force_limit=base_torue_const*base_current_limit/base_gear_ratio;equations	Base_joint_velocities=HW_bond.f[1:4];	Arm1_joint_velocities=HW_bond.f[5:9];	Base_joint_states=int(HW_bond.f[1:4]);	Arm1_joint_states=int(HW_bond.f[5:9],joint_initial_states);		RotMechanumWheel=Wheelpos[1]-Wheelpos[2];	A = (1/(2*MecanumWheelRadius))*	[ RotMechanumWheel,RotMechanumWheel,RotMechanumWheel	,RotMechanumWheel;		1		, 1		,-1		, -1;		-1		, 1		,-1		, 1]; 	PseudoInverseA = transpose(A)*inverse(A*transpose(A));	virtualJoints_f = transpose(PseudoInverseA)*HW_bond.f[1:4];	wheel_veloicties=PseudoInverseA*Base_twist_cmd;	Base_Twist=[0;0;virtualJoints_f[1];virtualJoints_f[3];virtualJoints_f[2];0];	   Base_dotT=Base_H*tilde(Base_Twist);   Base_H = int(Base_dotT,Base_init);//	H=H0*inverseH(homogeneous(eye(3),offset));	pitch =  arcsin(limit(Base_H[3,1],-1,1)); //m_el[2].x());	yaw = atan2(Base_H[2,1]/cos(pitch),Base_H[1,1]/cos(pitch));	Base_odometry_state[1]=yaw;	Base_odometry_state[2]=Base_H[1,4];	Base_odometry_state[3]=Base_H[2,4];	base_twist_delta=[Base_twist_cmd[1];Base_twist_cmd[3];Base_twist_cmd[2]]-virtualJoints_f;	if use_twist then		Base_joint_cmd_temp=PseudoInverseA*(base_PI_P*base_twist_delta);//+base_PI_I*int(base_twist_delta));	else		Base_joint_cmd_temp=Base_joint_cmd;	end;// HW_bond.e=0;   HW_bond.e[1]=limit(Base_joint_cmd_temp[1],-base_force_limit,base_force_limit);	HW_bond.e[2]=limit(Base_joint_cmd_temp[2],-base_force_limit,base_force_limit);	HW_bond.e[3]=limit(Base_joint_cmd_temp[3],-base_force_limit,base_force_limit);	HW_bond.e[4]=limit(Base_joint_cmd_temp[4],-base_force_limit,base_force_limit);	HW_bond.e[5]=limit(Arm1_joint_cmd[1],-force_limits[1],force_limits[1]);	HW_bond.e[6]=limit(Arm1_joint_cmd[2],-force_limits[2],force_limits[2]);	HW_bond.e[7]=limit(Arm1_joint_cmd[3],-force_limits[3],force_limits[3]);	HW_bond.e[8]=limit(Arm1_joint_cmd[4],-force_limits[4],force_limits[4]);	HW_bond.e[9]=limit(Arm1_joint_cmd[5],-force_limits[5],force_limits[5]);	implementation_end;     end;     connections      OneJunction1\p => I\p;      OneJunction1\p => R\p;      GravityImitation\joints => OneJunction1\p;      OneJunction1\p => stiction_M\port1;      YouBot_OODL\HW_bond => OneJunction1\p;      OneJunction1\p => JointSoftLimits1\p;      Base_twist_cmd -> YouBot_OODL\Base_twist_cmd;      Arm1_joint_cmd -> YouBot_OODL\Arm1_joint_cmd;      YouBot_OODL\Arm1_joint_states -> Arm1_joint_states;      YouBot_OODL\Base_odometry_state -> Base_odometry_state;      YouBot_OODL\Arm1_joint_velocities -> Arm1_joint_velocities;      YouBot_OODL\Base_joint_velocities -> Base_joint_velocities;      YouBot_OODL\Base_joint_states -> Base_joint_states;      Base_joint_cmd -> YouBot_OODL\Base_joint_cmd;     end;    implementation_end;  end;  connections   youBot_RTT_test\Base_joint_velocities -> YouBot_control_with_base\Base_joint_velocities;   CartesianSpaceStiffness\output -> YouBot_control_with_base\CartSpaceStiffness;   JointSpaceSetpoint\output -> YouBot_control_with_base\JointSpaceSetpoint;   youBot_RTT_test\Base_joint_states -> YouBot_control_with_base\Base_joint_states;   YouBot_control_with_base\Base_torque_cmd -> youBot_RTT_test\Base_joint_cmd;   youBot_RTT_test\Arm1_joint_velocities -> YouBot_control_with_base\Arm1_joint_velocites;   YouBot_control_with_base\Base_twist_cmd -> youBot_RTT_test\Base_twist_cmd;   youBot_RTT_test\Arm1_joint_cmd <- YouBot_control_with_base\Arm1_joint_cmd;   Hvp0\output -> YouBot_control_with_base\Hvp0;   youBot_RTT_test\Base_odometry_state -> YouBot_control_with_base\Measured_odometry;   youBot_RTT_test\Arm1_joint_states -> YouBot_control_with_base\Arm1_joint_states;   JointSpaceSetpoint1\output -> YouBot_control_with_base\JntSpaceStiffness;   HtipCC\output -> YouBot_control_with_base\HtipCC;  end; implementation_end;]]>
  </Sidops>
</Model>
 <Experiments>
  <DefaultExperiment><![CDATA[Experiment 1]]>
</DefaultExperiment>
  <Experiment>
   <Name>Experiment 1</Name>
   <CreatedBy></CreatedBy>
   <Info></Info>
   <ExpData>
    <VersionNumber>4.1</VersionNumber>
    <ModelProperties></ModelProperties>
    <Variables>
     <Constants></Constants>
     <Parameters></Parameters>
     <Initials>
      <Variable>
       <Name>YouBot_control_with_base\Integrate\initial</Name>
       <Rows>4</Rows>
       <Columns>4</Columns>
       <Description><![CDATA[initial value]]>
</Description>
       <Value>1 0 0 0
0 1 0 0
0 0 1 0
0 0 0 1</Value>
      </Variable>
      <Variable>
       <Name>youBot_RTT_test\I\state_initial</Name>
       <Rows>9</Rows>
       <Columns>1</Columns>
       <Value>0 0 0 0 0 0 0 0 0</Value>
      </Variable>
      <Variable>
       <Name>youBot_RTT_test\YouBot_OODL\Base_init</Name>
       <Rows>4</Rows>
       <Columns>4</Columns>
       <Value>1 0 0 0
0 1 0 0
0 0 1 0
0 0 0 1</Value>
      </Variable>
      <Variable>
       <Name>youBot_RTT_test\YouBot_OODL\Base_joint_states_initial</Name>
       <Rows>4</Rows>
       <Columns>1</Columns>
       <Value>0 0 0 0</Value>
      </Variable>
     </Initials>
    </Variables>
    <PlotSpecs>
     <VarNames>
      <VarName>time</VarName>
      <VarName>youBot_RTT_test\I\n_f</VarName>
     </VarNames>
     <Plots>
      <Plot>
       <PlotType>GraphPlot</PlotType>
       <BasePlot>
        <UseWindowsBGColor>true</UseWindowsBGColor>
        <BGColor>13160660</BGColor>
       </BasePlot>
       <Grid>
        <DrawGrid>true</DrawGrid>
        <GridColor>15780518</GridColor>
        <XTicks>10</XTicks>
        <YTicks>10</YTicks>
        <ZTicks>10</ZTicks>
        <Use3DLook>false</Use3DLook>
       </Grid>
       <PlotBGColor>16777215</PlotBGColor>
       <ShowPlotTitle>true</ShowPlotTitle>
       <TitlePosition>1</TitlePosition>
       <PlotTitle>model</PlotTitle>
       <ShowXValues>true</ShowXValues>
       <Fonts>
        <TitleFont>
         <Name>Arial</Name>
         <Height>12</Height>
         <PitchFamily>34</PitchFamily>
         <Weight>400</Weight>
         <Italic>0</Italic>
         <UnderLine>0</UnderLine>
         <StrikeOut>0</StrikeOut>
         <Color>0</Color>
        </TitleFont>
        <LabelFont>
         <Name>Arial</Name>
         <Height>12</Height>
         <PitchFamily>34</PitchFamily>
         <Weight>400</Weight>
         <Italic>0</Italic>
         <UnderLine>0</UnderLine>
         <StrikeOut>0</StrikeOut>
         <Color>0</Color>
        </LabelFont>
        <ValuesFont>
         <Name>Arial</Name>
         <Height>10</Height>
         <PitchFamily>34</PitchFamily>
         <Weight>400</Weight>
         <Italic>0</Italic>
         <UnderLine>0</UnderLine>
         <StrikeOut>0</StrikeOut>
         <Color>0</Color>
        </ValuesFont>
       </Fonts>
       <SharedXAxis>true</SharedXAxis>
       <SharedYAxis>true</SharedYAxis>
       <SharedZAxis>false</SharedZAxis>
       <XAxes>
        <Axis>
         <Minimum>0</Minimum>
         <Maximum>10</Maximum>
         <Linear>true</Linear>
         <Scaling>3</Scaling>
         <Label>time</Label>
        </Axis>
       </XAxes>
       <YAxes>
        <Axis>
         <Minimum>10.95</Minimum>
         <Maximum>11.45</Maximum>
         <Linear>true</Linear>
         <Scaling>1</Scaling>
         <Label>youBot_RTT_test\I\n_f</Label>
        </Axis>
       </YAxes>
       <ZAxes></ZAxes>
       <Curves>
        <Curve>
         <LineColor>16711680</LineColor>
         <LineStyle>1</LineStyle>
         <TickColor>16711680</TickColor>
         <TickStyle>0</TickStyle>
         <PixelThresshold>1</PixelThresshold>
         <LineThickness>1</LineThickness>
         <LineOrder>1</LineOrder>
         <ShowYValues>true</ShowYValues>
         <XCurveData>
     <ShowUnit>true</ShowUnit>
     <VarName>time</VarName>
         </XCurveData>
         <YCurveData>
     <ShowUnit>true</ShowUnit>
     <VarName>youBot_RTT_test\I\n_f</VarName>
         </YCurveData>
        </Curve>
       </Curves>
       <Legenda>
        <ShowLegenda>true</ShowLegenda>
       </Legenda>
       <StripChartPlots>
        <DistributState>0</DistributState>
       </StripChartPlots>
      </Plot>
     </Plots>
     <WindowRectangles virtualDesktopWidth="1680" virtualDesktopHeight="1028">
      <WindowRectangle monitor="0" left="0" top="0" right="1680" bottom="1028">0.386905 0.020428 0.936905 0.787938</WindowRectangle>
     </WindowRectangles>
    </PlotSpecs>
    <RunSpecs>
     <SimulatorSettings>
      <StartTime>0</StartTime>
      <FinishTime>10</FinishTime>
      <Warp>false</Warp>
      <UseOutputAfterEach>false</UseOutputAfterEach>
      <OutputAfterEach>0.1</OutputAfterEach>
      <EventEpsilon>1e-006</EventEpsilon>
      <AlgebraicTolerance>1e-007</AlgebraicTolerance>
      <SteadyStateAnalysis>false</SteadyStateAnalysis>
      <UpdateHoldInstructions>true</UpdateHoldInstructions>
     </SimulatorSettings>
     <IntegrationMethods>
      <IntegrationMethod>
       <Name>Euler</Name>
       <StepSize>0.01</StepSize>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>BackwardEuler</Name>
       <AbsoluteTolerance>1e-005</AbsoluteTolerance>
       <RelativeTolerance>1e-005</RelativeTolerance>
       <AlgebraicAbsoluteTolerance>1e-005</AlgebraicAbsoluteTolerance>
       <AlgebraicRelativeTolerance>1e-005</AlgebraicRelativeTolerance>
       <StepSize>0.01</StepSize>
       <Alpha>1</Alpha>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>AdamsBashforth</Name>
       <StepSize>0.01</StepSize>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>RungeKutta2</Name>
       <StepSize>0.01</StepSize>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>RungeKutta4</Name>
       <StepSize>0.01</StepSize>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>RungeKutta8</Name>
       <UseInitialStepSize>false</UseInitialStepSize>
       <InitialStepSize>0.001</InitialStepSize>
       <UseMaximumStepSize>false</UseMaximumStepSize>
       <MaximumStepSize>1</MaximumStepSize>
       <AbsoluteTolerance>1e-006</AbsoluteTolerance>
       <RelativeTolerance>1e-006</RelativeTolerance>
       <SafetyFactor>0.9</SafetyFactor>
       <Factor1>0.33</Factor1>
       <Factor2>6</Factor2>
       <Beta>0</Beta>
       <UseMaxNrSteps>false</UseMaxNrSteps>
       <MaxNrSteps>100000</MaxNrSteps>
       <UseStiffDetection>false</UseStiffDetection>
       <MaxNrStiffnessSteps>1000</MaxNrStiffnessSteps>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>RungeKuttaFehlberg</Name>
       <UseInitialStepSize>false</UseInitialStepSize>
       <InitialStepSize>0.001</InitialStepSize>
       <UseMaximumStepSize>false</UseMaximumStepSize>
       <MaximumStepSize>1</MaximumStepSize>
       <AbsoluteTolerance>1e-006</AbsoluteTolerance>
       <RelativeTolerance>1e-006</RelativeTolerance>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>VodeAdams</Name>
       <UseInitialStepSize>false</UseInitialStepSize>
       <InitialStepSize>0.001</InitialStepSize>
       <UseMaximumStepSize>false</UseMaximumStepSize>
       <MaximumStepSize>1</MaximumStepSize>
       <AbsoluteTolerance>1e-006</AbsoluteTolerance>
       <RelativeTolerance>1e-006</RelativeTolerance>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>BDFMethod</Name>
       <AbsoluteTolerance>1e-005</AbsoluteTolerance>
       <RelativeTolerance>1e-005</RelativeTolerance>
       <AlgebraicAbsoluteTolerance>1e-005</AlgebraicAbsoluteTolerance>
       <AlgebraicRelativeTolerance>1e-005</AlgebraicRelativeTolerance>
       <UseInitialStepSize>false</UseInitialStepSize>
       <InitialStepSize>0.001</InitialStepSize>
       <UseMaximumStepSize>false</UseMaximumStepSize>
       <MaximumStepSize>1</MaximumStepSize>
       <UseFixedStepSize>false</UseFixedStepSize>
       <FixedStepSize>0</FixedStepSize>
      </IntegrationMethod>
      <IntegrationMethod>
       <Name>MeBDFiMethod</Name>
       <AbsoluteTolerance>1e-005</AbsoluteTolerance>
       <RelativeTolerance>1e-005</RelativeTolerance>
       <AlgebraicAbsoluteTolerance>1e-005</AlgebraicAbsoluteTolerance>
       <AlgebraicRelativeTolerance>1e-005</AlgebraicRelativeTolerance>
       <UseInitialStepSize>false</UseInitialStepSize>
       <InitialStepSize>0.001</InitialStepSize>
       <UseMaximumStepSize>false</UseMaximumStepSize>
       <MaximumStepSize>1</MaximumStepSize>
       <UseFixedStepSize>false</UseFixedStepSize>
       <FixedStepSize>0</FixedStepSize>
      </IntegrationMethod>
      <SelectedIntegrationMethod>8</SelectedIntegrationMethod>
     </IntegrationMethods>
    </RunSpecs>
    <MultipleRun>
     <NrSteps>10</NrSteps>
     <CopyFromStates>false</CopyFromStates>
     <JoinParameterVariation>true</JoinParameterVariation>
     <ClearAfterRun>true</ClearAfterRun>
     <RedrawAfterRun>false</RedrawAfterRun>
     <DrawDuringSimulation>true</DrawDuringSimulation>
     <ActionBeforeOptimization>0</ActionBeforeOptimization>
     <CompareValue>0</CompareValue>
     <UseCompareValue>true</UseCompareValue>
     <MultipleRunType>MultipleRun</MultipleRunType>
     <Minimize>true</Minimize>
     <OptimizationVariable></OptimizationVariable>
     <ResulVarUsage>UseEndValue</ResulVarUsage>
     <Tolerance>0.001</Tolerance>
     <OptimizationMethod>BroydonFletcherGoldfarbShanno</OptimizationMethod>
     <MultipleRunVariables></MultipleRunVariables>
    </MultipleRun>
    <ExportData>
     <WriteAsText>true</WriteAsText>
     <ReadAsText>true</ReadAsText>
     <WriteHeader>true</WriteHeader>
     <ReadHeader>true</ReadHeader>
     <ReadFilename></ReadFilename>
     <WriteFilename></WriteFilename>
     <DoWrite>false</DoWrite>
     <ExportVariables>
      <ExportVariable>
       <VariableName>time</VariableName>
      </ExportVariable>
     </ExportVariables>
     <ImportVariables></ImportVariables>
    </ExportData>
    <BreakPoints></BreakPoints>
    <AnimationPlayback>
     <PlaybackSpeed>1</PlaybackSpeed>
    </AnimationPlayback>
   </ExpData>
  </Experiment>
 </Experiments>
</Document>
